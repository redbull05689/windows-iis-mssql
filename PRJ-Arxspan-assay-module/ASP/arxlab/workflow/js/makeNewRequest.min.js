var initNewRequestPromise=[],makeNewRequestModule=function(){var hideRequestEditor=function(){$(".dropdownEditorContainer").removeClass("makeVisible")},showRequestEditor=function(requestId){return new Promise((function(resolve,reject){window.location.href.includes("makenewrequest")&&resetRequestEditor(),$(".dropdownEditorContainer").addClass("makeVisible"),resolve(!0)}))},resetRequestEditor=function(){$('.dropdownEditorContainer input[type="text"]').val(""),$('.dropdownEditorContainer input[type="checkbox"]').prop("checked",!1),$(".dropdownEditorContainer").find("button, input, select").prop("disabled",!1);var requestId="";window.self!=window.top&&(requestId=window.parent.$("#requestId").val()),$(".dropdownEditorContainer").attr("requestid",requestId),$(".dropdownEditorContainer").find("#requestFieldsEditorSection .editorSection").empty(),$(".dropdownEditorContainer .prioritizeThisRequestContainer").remove(),$(".dropdownEditorContainer .requestItemsEditorSection").attr("requestitemtypeid",null).attr("requestitemid",null).empty(),$(".requestItemsEditor").remove(),window.requestItemTypesColumns={},$(".dropdownEditorContainer select option:first-of-type").prop("selected",!0).parent().change()},replaceSavedFieldsDropdownOptions=function(replacementDropdowns,versionedFields){$.each(versionedFields,(function(savedFieldIndex,savedField){5==savedField.dataTypeId&&$.each(replacementDropdowns,(function(replacementDropdownIndex,replacementDropdown){savedField.dropDownId==replacementDropdown.id&&(savedField.options=replacementDropdown.options)}))}))},disableDisallowedAssignedUserGroups=function(requestType){return new Promise((function(resolve,reject){userGroupsWithCanBeAssigned=[],null!=requestType.allowedGroups&&$.each(requestType.allowedGroups,(function(){this.canBeAssigned&&userGroupsWithCanBeAssigned.push(this.groupId)}));var OptionAval=!1,selectedOpt=void 0;$.each($("select#assignedUserGroupDropdown option"),(function(){1==$(this).prop("selected")&&(selectedOpt=this)})),$.each($("select#assignedUserGroupDropdown option"),(function(){$.inArray(parseInt($(this).attr("groupid")),userGroupsWithCanBeAssigned)>-1?($(this).attr("disabled",!1),OptionAval=!0,$(this).prop("selected",!0)):$(this).attr("disabled",!0)})),null!=selectedOpt&&$(selectedOpt).prop("selected",!0),OptionAval||$.each($("select#assignedUserGroupDropdown option"),(function(){$.inArray(parseInt($(this).attr("groupid")),globalUserInfo.userGroups)>-1?$(this).attr("disabled",!1):$(this).attr("disabled",!0)})),$("select#assignedUserGroupDropdown option:selected").attr("disabled")&&$.each($("select#assignedUserGroupDropdown option"),(function(){if(!$(this).attr("disabled"))return $(this).prop("selected",!0),!1})),resolve(!0)}))},changeRequestTypeDropdown=function(){return new Promise((function(resolve,reject){var thisRequestTypeId;thisRequestTypeId=window.self!=window.top?window.parent.$("#requestTypeId").val():$("select#requestTypeDropdown").find(":selected").attr("requesttypeid"),"repeatRequest"!=window.top.CurrentPageMode?ajaxModule().getVersionedConfigData(thisRequestTypeId).then((function(configResponses){var thisRequestType=configResponses[2][0],versionedRequestItems=configResponses[1],versionedFields=configResponses[0];window.top.thisRequestType=thisRequestType,window.top.versionedRequestItems=versionedRequestItems,window.top.versionedFields=versionedFields;var submitButtonText=thisRequestType.showPrioritizationOnSubmit?"Prioritize & Submit":"Submit",cancelNewRequestButtonText="Cancel";$(".dropdownEditorContainer").find(".prioritizeNewRequestButton").text(submitButtonText),$(".dropdownEditorContainer").find(".cancelNewRequestButton").text("Cancel"),void 0!==thisRequestType&&requestEditorHelper.populateUserGroupsList().then(disableDisallowedAssignedUserGroups(thisRequestType)).then((function(){var fieldPromises=[];fieldPromises.push(requestEditorHelper.populateRequestFieldsSection(thisRequestType,selectorString=".editorSection[sectionid='requestFields']",null,!0,window.top.versionedFields,window.top.thisRequestType,window.top.versionedRequestItems)),fieldPromises.push(requestEditorHelper.populateRequestItemsEditorSectionInRequestEditor(null,thisRequestType,$(".requestItemsEditorSection"),versionedRequestItems,versionedFields)),Promise.all(fieldPromises).then((function(){$.each(versionedRequestItems,(function(requestItemTypeIndex,requestItem){var requestItemTypeId=requestItem.id,rowsArray=[{uniqueIdentifier_hidden:randomString(32,"#A"),sortOrder:1}],columnsArray=dataTableModule().makeColumnsArray(requestItemTypeId,versionedRequestItems,versionedFields);tableData={data:rowsArray,columns:columnsArray},dataTableModule().initRequestItemTable(tableData,requestItemTypeId,"",thisRequestType,versionedRequestItems,versionedFields)})),requestEditorHelper.populateDraftVals(thisRequestType,versionedRequestItems,versionedFields)}))})).then((function(){window.self!=window.top?resolve(!0):requestEditorHelper.bindRichTextFields(versionedRequestItems,versionedFields).then((function(){requestFieldHelper().applyDependencies(thisRequestType,versionedFields)}))})).then((function(){resolve(!0)}))})):resolve(!1)}))},populateRequestsTypesListForNewRequestPage=function(){return new Promise((function(resolve,reject){ajaxModule().getRequestTypesICanAdd().then((function(response){if(response){response=utilities().decodeServiceResponce(response);var defaultOptions=0,dropdown=$("<select></select>");$.each(response,(function(index,requestType){var requestTypeOption=$("<option></option>").attr("value",index).attr("requestTypeId",requestType.id).text(requestType.displayName),reqTypeId;(1==requestType.isDefault?(dropdown.prepend(requestTypeOption),dropdown.val(index),defaultOptions=index):dropdown.append(requestTypeOption),window.top!=window.self)&&(window.parent.$("#requestTypeId").val()==requestType.id&&(preSelect=index))})),$("body").addClass("canMakeNewRequest"),utilities().sortDropdownlist(dropdown),0==$("select#requestTypeDropdown").children().length&&(window.savedFieldsOptionsHTML=dropdown.html(),$("select#requestTypeDropdown").html(window.savedFieldsOptionsHTML),window.top!=window.self?(console.log(preSelect),$("select#requestTypeDropdown").val(preSelect),console.log("CHANGED IT!")):$("select#requestTypeDropdown").val(defaultOptions))}resolve(!0)}))}))},makeNewRequestReady=function(){window.initOnce=!1,window.replacementDropdownsByRequestType={};var promiseChain=[];window.self==window.top&&promiseChain.push(populateRequestsTypesListForNewRequestPage()),Promise.all(promiseChain).then((function(){showRequestEditor().then((function(){var thisRequestTypeId;thisRequestTypeId=window.self!=window.top?window.parent.$("#requestTypeId").val():$("select#requestTypeDropdown").find(":selected").attr("requesttypeid"),initNewRequestPromise.push(changeRequestTypeDropdown()),Promise.all(initNewRequestPromise).then((function(reply){0!=reply[0]&&(requestEditorHelper.finalizeRequestEditorInitialization(),$("body").on("change","select#requestTypeDropdown",(function(event){changeRequestTypeDropdown()}))),$("body").on("change","select#assignedUserGroupDropdown",(function(event){var replacingOptions=!1;void 0!==window.replacementDropdownsByRequestType[requestTypeId]&&void 0!==window.replacementDropdownsByRequestType[thisRequestTypeId][$('.requestEditorContainer.newRequestEditor .editorField[fieldid="assignedUserGroup"] #assignedUserGroupDropdown').val()]||(console.log("replaceDropdownOptions: true!"),replacingOptions=!0),replacingOptions||replaceSavedFieldsDropdownOptions(window.replacementDropdownsByRequestType[thisRequestTypeId][$('.requestEditorContainer.newRequestEditor .editorField[fieldid="assignedUserGroup"] #assignedUserGroupDropdown').val()],fields),changeRequestTypeDropdown()})),$("body").on("click",".requestEditorCancel",(function(event){hideRequestEditor()})),$("body").on("click",".newRequestButton",(function(event){showRequestEditor()})),$("body").on("click",".structureImageContainer",(function(event){$(".isCheckedOut")[0]||utilities().showUnsavedChangesNotification()})),$("body").on("click",".prioritizeNewRequestButton",(function(event){$(".isCheckedOut")[0]?void 0!==window.upsertRequestNotification?window.upsertRequestNotification.update({title:"Error",message:"A structure needs to be checked in.",type:"danger"}):window.upsertRequestNotification=$.notify({title:"Error",message:"A structure needs to be checked in."},{delay:0,type:"danger",template:utilities().notifyJSTemplates.default,onClose:function(){window.upsertRequestNotification=void 0}}):($(this).attr("disabled",!0),requestEditorHelper.clickRequestSubmitButton(null,thisRequestType,versionedRequestItems,versionedFields))})),$("body").on("click",".cancelNewRequestButton",(function(){window.location="/arxlab/workflow"}))}))}))}))};return{disableDisallowedAssignedUserGroups:disableDisallowedAssignedUserGroups,showRequestEditor:showRequestEditor,makeNewRequestReady:makeNewRequestReady}};$(document).ready((function(){makeNewRequestModule().makeNewRequestReady()}));
//# sourceMappingURL=makeNewRequest.min.js.map