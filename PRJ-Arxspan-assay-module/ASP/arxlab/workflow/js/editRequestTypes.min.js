const CUST_ATTR_DATA_TYPES={STRING:1,NUMERIC:2,DATE:3,LONG_TEXT:4,BOOLEAN:5,DROP_DOWN:6};let CUST_ATTR_DATA_TYPE_LABELS={};CUST_ATTR_DATA_TYPE_LABELS[CUST_ATTR_DATA_TYPES.STRING]="String",CUST_ATTR_DATA_TYPE_LABELS[CUST_ATTR_DATA_TYPES.NUMERIC]="Numeric",CUST_ATTR_DATA_TYPE_LABELS[CUST_ATTR_DATA_TYPES.DATE]="Date",CUST_ATTR_DATA_TYPE_LABELS[CUST_ATTR_DATA_TYPES.LONG_TEXT]="Long Text",CUST_ATTR_DATA_TYPE_LABELS[CUST_ATTR_DATA_TYPES.BOOLEAN]="Boolean",CUST_ATTR_DATA_TYPE_LABELS[CUST_ATTR_DATA_TYPES.DROP_DOWN]="Drop Down";let custAttrDefList=[],requestTypeCustomAttributeDefinitions=[];var editRequestTypes=function(){var fieldGroups="ABCDEFGHIJKLMNOPQRSTUVWXYZ",fieldGroupsDropdown=$('<select class="fieldGroupDropdown editorFieldDropdown">').html('<option value=""></option>'),resetRequestTypeEditor=function(){custAttrDefList=[],requestTypeCustomAttributeDefinitions=[],$('.dropdownEditorContainer input[type="text"]').val(""),$('.dropdownEditorContainer input[type="checkbox"]').prop("checked",!1),$(".dropdownEditorContainer").find("button, input, select").prop("disabled",!1),$(".dropdownEditorContainer select option:first-of-type").prop("selected",!0),$(".dropdownEditorContainer").removeClass("isSavedField"),$(".dropdownEditorContainer").attr("requesttypeid",""),$(".dropdownEditorContainer").attr("datatypeid",""),$("table#requestTypeFieldsTable > tbody").empty(),$("table#requestTypeRequestItemTypesTable > tbody").empty(),$("#requestTypeAllowedUsersEditorSection, #requestTypeAllowedGroupsEditorSection, .requestTypeFieldNotificationsContainer").removeClass("makeVisible"),$("select#requestTypesDropdownForNotificationSettings").empty(),$("select#requestTypeAllowedAppsSelect").empty(),$("select#requestTypeAllowedAppsSelect").val(null),$("select#requestTypeAllowedAppsSelect").attr("multiple",!1),$("select#requestTypeAllowedAppsSelect").attr("disabled",!1),$("#requestTypeCustomAttributesTable > tbody").empty(),$("#requestTypeAttributeTable").hide(),$("#requestTypeFieldAttributesTable").hide(),"requestItemTypes"==window.requestTypePageMode?($(".editorField[fieldid='colabNotification']").hide(),$(".editorField[fieldid='showPrioritizationOnSubmit']").hide(),$("#requestTypeAllowedAppsEditorSection").hide()):($("#requestNameOptions").removeClass("in"),$("#requestTypeAllowedAppsEditorSection").show())},showRequestTypeEditor=async function(requestTypeId){resetRequestTypeEditor();let appList=[];if("requestTypes"==window.requestTypePageMode&&(appList=await ajaxModule().getAllowedApps(),await populateApplications(appList)),requestTypeId){$(".dropdownEditorContainer").attr("requesttypeid",requestTypeId);var requestType=window.pageModeRequestTypes.find(x=>x.id==requestTypeId);if(requestType){requestType.requestTypeCustomAttributeDefinitions.length>0&&(requestTypeCustomAttributeDefinitions=requestType.requestTypeCustomAttributeDefinitions),$('.dropdownEditorContainer .editorField[fieldid="displayName"] input[type="text"]').val(requestType.displayName),$('.dropdownEditorContainer .editorField[fieldid="hoverText"] input[type="text"]').val(requestType.hoverText),$("#staticNameString").val(requestType.reqNamePrefix),$("#staticNameSortOrder").val(requestType.reqNamePrefixOrder),$("#requestNameSelectField").attr("saveditem",requestType.reqNameRequestTypeFieldId),$("#groupSortOrder").val(requestType.reqNameUseUserGroupIdOrder),$("#useAssignedGroup").prop("checked",1==requestType.reqNameUseUserGroupId),$("#fieldInNameSortOrder").val(requestType.reqNameRequestTypeFieldIdOrder),null!=requestType.reqNameUseIncrementingNumbersCode?$("#selectIncromentingNum").val(requestType.reqNameUseIncrementingNumbersCode):$("#selectIncromentingNum").val(0),$("#incromentingNumSortOrder").val(requestType.reqNameUseIncrementingNumbersCodeOrder),"requestTypes"==window.requestTypePageMode?($("#configRequestNotifications").attr("requestTypeNotificationGroupSettings",stringNotifications(requestType.requestTypeNotificationGroupSettings)),$("#configRequestNotifications").attr("requestTypeNotificationUserSettings",stringNotifications(requestType.requestTypeNotificationUserSettings)),$("#configRequestNotifications").attr("requestTypeNotificationOtherUserSettings",stringNotifications(requestType.requestTypeNotificationOtherUserSettings))):$("#configRequestNotifications").hide();var greatestFieldGroupNumber=0,processedRequestTypeFieldIds=[];if($.each(requestType.fields,(function(index,field){field.fieldGroup>greatestFieldGroupNumber&&-1==processedRequestTypeFieldIds.indexOf(field.requestTypeFieldId)&&(processedRequestTypeFieldIds.push(field.requestTypeFieldId),greatestFieldGroupNumber=field.fieldGroup)})),updateGlobalFieldGroupsDropdown(greatestFieldGroupNumber),requestType.frozenColumnsLeft||(requestType.frozenColumnsLeft=0),$('.dropdownEditorContainer .editorField[fieldid="frozenColumnsLeft"] input[type="number"]').val(requestType.frozenColumnsLeft),processedRequestTypeFieldIds=[],$.each(requestType.fields,(function(index,field){var requestTypeFieldId=field.requestTypeFieldId;-1==processedRequestTypeFieldIds.indexOf(requestTypeFieldId)&&(processedRequestTypeFieldIds.push(requestTypeFieldId),addRequestTypeFieldToEditor(field));var thisRow=$(`tr[requesttypefieldid=${requestTypeFieldId}]`);if(null==thisRow.attr("defaultValueJson")){var initDefaultValueJson={company:null,user:{},group:{}};thisRow.attr("defaultValueJson",JSON.stringify(initDefaultValueJson))}var defaultValueJson=JSON.parse(thisRow.attr("defaultValueJson"));field.userDefaultValue?defaultValueJson.user[field.userId]=field.userDefaultValue:field.groupDefaultValue?defaultValueJson.group[field.groupId]=field.groupDefaultValue:field.defaultValue&&(defaultValueJson.company=field.defaultValue),thisRow.attr("defaultValueJson",JSON.stringify(defaultValueJson))})),requestType.requestItemTypes&&$.each(requestType.requestItemTypes,(function(index,requestItemType){addRequestItemTypeToEditor(requestItemType)})),$('.dropdownEditorContainer .editorField[fieldid="requiresApproval"] input[type="checkbox"]').prop("checked",requestType.requiresApproval),$('.dropdownEditorContainer .editorField[fieldid="isDefault"] input[type="checkbox"]').prop("checked",requestType.isDefault),requestType.hasOwnProperty("notifyColabs")&&$('.dropdownEditorContainer .editorField[fieldid="colabNotification"] input[type="checkbox"]').prop("checked",requestType.notifyColabs),$('.dropdownEditorContainer .editorField[fieldid="restrictAccess"] input[type="checkbox"]').prop("checked",requestType.restrictAccess).change(),$('.dropdownEditorContainer .editorField[fieldid="showPrioritizationOnSubmit"] input[type="checkbox"]').prop("checked",requestType.showPrioritizationOnSubmit).change(),$('.dropdownEditorContainer .editorField[fieldid="searchRegForExistingCompound"] input[type="checkbox"]').prop("checked",requestType.searchRegForExistingCompound).change(),$('.dropdownEditorContainer .editorField[fieldid="registerNewCompounds"] input[type="checkbox"]').prop("checked",requestType.registerNewCompounds).change(),$('.dropdownEditorContainer .editorField[fieldid="checkIfStructIsRequestedBeforeReg"] input[type="checkbox"]').prop("checked",requestType.checkIfStructIsRequestedBeforeReg).change(),$('.dropdownEditorContainer .editorField[fieldid="genNotebook"]').empty(),$('.dropdownEditorContainer .editorField[fieldid="genProject"]').empty(),populateRestrictAccessSettingsTables("requestType",requestType.allowedUsers,requestType.allowedGroups),requestType.allowedApps){let allowedIds=appList.map(allowedApp=>allowedApp.name in requestType.allowedApps?allowedApp.id:null).filter(x=>x),multipleIds=allowedIds.length>1;$("#requestTypeAllowedAppsSelect").attr("multiple",multipleIds),multipleIds?$("#requestTypeAllowedAppsSelect").val(allowedIds):1==allowedIds.length&&($("#requestTypeAllowedAppsSelect").val(allowedIds[0]),await updateCustAttrDefs(allowedIds[0])),$("select#requestTypeAllowedAppsSelect").attr("disabled",!0)}if(requestType.requestTypeCustomAttributeValues&&requestType.requestTypeCustomAttributeValues.forEach((function(val,index){addCustomAttributeToEditor(val,requestType.requestTypeCustomAttributeDefinitions)})),"requestTypes"==window.requestTypePageMode?(requestType.requestTypeReprioritizationNotificationGroupSettings&&$.each(requestType.requestTypeReprioritizationNotificationGroupSettings,(function(){$("table#requestTypeReprioritizationNotificationsTable").find('tr[groupid="'+this.groupId+'"] input.notifyByEmailCheckbox').prop("checked",this.notifyByEmail)})),$("#numFrozenColumns").attr("max","5"),$("input[name='SortSelect']").on("mouseup",(function(event){0==window.top.isSupport?0==$("input[name='SortSelect']:checked").length?swal({title:"Once you save this option you will not have the ability to change or modify it.",text:"Are you sure you want to make this change?",type:"warning",confirmButtonText:"Yes",cancelButtonText:"No",showCancelButton:!0},(function(isConfirm){isConfirm?$(event.target).closest("tr").attr("filterField","1"):$(event.target).prop("checked",!1)})):window.top.preventClick=!0:($("tr[filterField='1']").attr("filterField",""),$(event.target).closest("tr").attr("filterField","1"))})),$("input[name='SortSelect']").on("click",(function(event){1==window.top.preventClick&&(event.preventDefault(),swal("Please contact support@arxspan.com!","This action may lead to data loss.","warning"),window.top.preventClick=!1),console.log(event)}))):$('div[fieldid="checkIfStructIsRequestedBeforeReg"]').hide(),1==requestType.disabled?requestType.disabled=!0:requestType.disabled=!1,$('.dropdownEditorContainer .editorField[fieldid="disabled"] input[type="checkbox"]').prop("checked",requestType.disabled),$(".dropdownEditorContainer").attr("requesttypeid",requestType.requestTypeId),$("#configRequestNotifications").attr("requesttypeid",requestTypeId),"requestItemTypes"==window.requestTypePageMode){var requestType_requestItemTypesDropdownOptionsArray=[];$.each(window.requestTypesArray,(function(reqTypeIndex,reqType){$.each(reqType.requestItemTypes,(function(){if(this.requestItemTypeId==requestType.id){var dataTypeOption=$("<option></option>").attr("value",this.requestItemId).text(reqType.displayName);requestType_requestItemTypesDropdownOptionsArray.push(dataTypeOption)}}))})),$("select#requestTypesDropdownForNotificationSettings").append(requestType_requestItemTypesDropdownOptionsArray),$("#requestTypeIncludeOnDash").text("")}}$(".dropdownEditorContainer").addClass("makeVisible isSavedField")}else $(".dropdownEditorContainer").addClass("makeVisible"),"requestTypes"==window.requestTypePageMode&&addRequestItemTypeToEditor(),$('.dropdownEditorContainer .editorField[fieldid="displayName"] input[type="text"]').focus(),$("#configRequestNotifications").attr("requesttypeid",-1),$(".requestTypeReprioritizationNotificationsContainer").hide(),await updateCustAttrDefs($("#requestTypeAllowedAppsSelect").val());$(".ui-sortable").sortable({start:function(event,ui){utilities().showUnsavedChangesNotification()}}),$(".main-panel").scrollTop(0),"requestTypes"!=window.requestTypePageMode&&$("#configRequestNameAccord").hide(),1==window.historical&&$(".dropdownEditorSubmit ").remove()},hideRequestTypeEditor=function(){$(".dropdownEditorContainer").removeClass("makeVisible")};let checkIfAnyPermissions=function(permissionsList,permissionNamesList){let anyPermissions=!1;return permissionNamesList.some((function(permName){let hasPermission=permissionsList.some(perm=>1==perm[permName]);hasPermission&&(anyPermissions=hasPermission)})),anyPermissions};var submitRequestItemTypeEditor=function(){return new Promise((function(resolve,reject){editor=$(".dropdownEditorContainer");var requestTypeName=editor.find('[fieldid="displayName"] input[type="text"]').val();if("requestTypes"==window.requestTypePageMode)var reqTypeOrReqItemTypeNotificationText="request type";else var reqTypeOrReqItemTypeNotificationText="request item type";if(""!==editor.attr("requesttypeid"))var notificationTitle="Updating "+reqTypeOrReqItemTypeNotificationText+' "'+requestTypeName+'"...';else var notificationTitle="Creating new "+reqTypeOrReqItemTypeNotificationText+' "'+requestTypeName+'"...';window.upsertRequestTypeNotification=$.notify({title:notificationTitle,message:""},{delay:0,type:"yellowNotification"});var requestTypeId=""!==editor.attr("requesttypeid")?parseInt(editor.attr("requesttypeid")):0,requestItemTypePermArray=[];$.each(editor.find(".allowedUsers > button"),(function(){var userId=parseInt($(this).attr("userid"));allowedUser={requestItemTypeId:requestTypeId,allowedUserId:userId,allowedGroupId:null,canAdd:utilities().boolToInt($(".CanAddCheckbox[userId="+userId+"]").prop("checked")),canView:utilities().boolToInt($(".CanViewCheckbox[userId="+userId+"]").prop("checked")),canEdit:utilities().boolToInt($(".CanEditCheckbox[userId="+userId+"]").prop("checked")),canDelete:utilities().boolToInt($(".CanDeleteCheckbox[userId="+userId+"]").prop("checked"))},requestItemTypePermArray.push(allowedUser)})),$.each(editor.find(".allowedGroups > button"),(function(){var groupId=parseInt($(this).attr("groupid"));allowedGroup={requestItemTypeId:requestTypeId,allowedUserId:null,allowedGroupId:groupId,canAdd:utilities().boolToInt($(".CanAddCheckbox[groupId="+groupId+"]").prop("checked")),canView:utilities().boolToInt($(".CanViewCheckbox[groupId="+groupId+"]").prop("checked")),canEdit:utilities().boolToInt($(".CanEditCheckbox[groupId="+groupId+"]").prop("checked")),canDelete:utilities().boolToInt($(".CanDeleteCheckbox[groupId="+groupId+"]").prop("checked"))},requestItemTypePermArray.push(allowedGroup)}));let restrictAccess=utilities().boolToInt(editor.find('[fieldid="restrictAccess"] input[type="checkbox"]').prop("checked")),permissionTypesList;if(1==restrictAccess&&!checkIfAnyPermissions(requestItemTypePermArray,["canAdd","canView","canEdit","canDelete"]))return window.upsertRequestTypeNotification.update({title:"There are no permissions set on this restricted request item type.",message:"Please select permissions to continue.",type:"danger"}),void reject();typeFieldsArray=[],$.each(editor.find("table#requestTypeFieldsTable > tbody > tr"),(function(requestTypeFieldIndex){requestTypeFieldId=0,$(this).attr("requesttypefieldid")&&(requestTypeFieldId=$(this).attr("requesttypefieldid")),savedFieldId=$(this).find("select.savedFieldDropdown option:selected").attr("savedfieldid");var dataTypeId=parseInt($(this).attr("datatypeid")),defaultValue="",defaultValueJson={},defaultValueAttr=$(this).attr("defaultvaluejson");defaultValueAttr&&(defaultValueJson=JSON.parse(defaultValueAttr)),$.inArray(dataTypeId,[dataTypeEnums.TEXT,dataTypeEnums.LONG_TEXT,dataTypeEnums.INTEGER,dataTypeEnums.REAL_NUMBER,dataTypeEnums.DROP_DOWN])>-1&&defaultValueJson.company&&(defaultValue=defaultValueJson.company);var requestItemTypeFieldDefaultValuesByGroupArray=packageDefaultValuesForSubmission(defaultValueJson,"group"),requestItemTypeFieldDefaultValuesByUserArray=packageDefaultValuesForSubmission(defaultValueJson,"user"),filterValue;fieldGroup=null,""!==$(this).find("td.requestTypeFieldGroupTD select.fieldGroupDropdown").val()&&(fieldGroup=parseInt($(this).find("td.requestTypeFieldGroupTD select.fieldGroupDropdown").val())+1),0!=$(this).find("#SortDropDown").length?filterValue=$($(this).find("#SortDropDown")[0]).val():0!=$(this).find("#SortLabel").length&&(filterValue=$($(this).find("#SortLabel")[0]).val()),filterValue=filterValue||null;var biDirectionalLink=checkForNewBidirectionalField(requestTypeFieldId,dataTypeId)?1:utilities().boolToInt("true"==$(this).attr("biDirectinalLink")),thisField={id:requestTypeFieldId,fieldId:savedFieldId,required:utilities().boolToInt(parseInt($(this).attr("isrequired"))),allowMultiple:utilities().boolToInt(parseInt($(this).attr("allowmultiple"))),disabled:utilities().boolToInt(parseInt($(this).attr("isdisabled"))),sortOrder:requestTypeFieldIndex+1,restrictAccess:utilities().boolToInt(parseInt($(this).attr("restrictaccess"))),defaultValue:defaultValue,requestItemTypeFieldDefaultValuesByGroups:requestItemTypeFieldDefaultValuesByGroupArray,requestItemTypeFieldDefaultValuesByUsers:requestItemTypeFieldDefaultValuesByUserArray,fieldGroup:fieldGroup,clearWhenDuplicate:dataTypeId==dataTypeEnums.UNIQUE_ID?1:utilities().boolToInt(parseInt($(this).attr("clearWhenDuplicate"))),filterField:utilities().boolToInt($(this).find("input[type=radio]").prop("checked")),filterValue:filterValue,autoGenerateNotebook:utilities().boolToInt("true"==$(this).attr("autoGenNotebook")),autoGenerateExperiment:utilities().boolToInt("true"==$(this).attr("autoGenExperement")),autoGenerateProject:utilities().boolToInt("true"==$(this).attr("autoGenProject")),bidirectionalRequestLinking:biDirectionalLink,sendToELN:utilities().boolToInt("true"==$(this).attr("sendToELN"))};if($(this).attr("notificationsettings")){notificationGroupSettingArray=[];var notificationSettingsObject=JSON.parse($(this).attr("notificationsettings"));$.each(Object.keys(notificationSettingsObject),(function(notificationIndex,notificationSettingKey){var notificationGroupSetting,notificationSettingsArray=notificationSettingsObject[notificationSettingKey].groups;$.each(notificationSettingsArray,(function(notificationSettingsIndex,notificationSetting){thisSetting={requestItemTypeFieldId:requestTypeId,groupId:notificationSetting.groupId,notifyByEmail:utilities().boolToInt(notificationSetting.notifyByEmail),notifyByBrowser:utilities().boolToInt(notificationSetting.notifyByBrowser)},notificationGroupSettingArray.push(thisSetting)}))})),thisField.requestItemTypeFieldNotificationGroupSettings=notificationGroupSettingArray}if(thisField.requestItemTypeFieldNotificationUserSettings=null,fieldPermArray=[],$(this).attr("restrictaccesssettings")){var restrictAccessSettingsObject=JSON.parse($(this).attr("restrictaccesssettings")),allowedUsers=restrictAccessSettingsObject.users,allowedGroups=restrictAccessSettingsObject.groups;if(allowedUsers&&$.each(allowedUsers,(function(userIndex,allowedUser){thisPerm={requestItemTypeFieldId:requestTypeId,allowedUserId:allowedUser.userId,allowedGroupId:null,canAdd:utilities().boolToInt(dataTypeId==dataTypeEnums.UNIQUE_ID||allowedUser.canAdd),canEdit:utilities().boolToInt(allowedUser.canEdit),canView:utilities().boolToInt(allowedUser.canView),canDelete:utilities().boolToInt(allowedUser.canDelete)},fieldPermArray.push(thisPerm)})),allowedGroups&&$.each(allowedGroups,(function(userIndex,allowedGroup){thisPerm={requestItemTypeFieldId:requestTypeId,allowedUserId:null,allowedGroupId:allowedGroup.groupId,canAdd:utilities().boolToInt(dataTypeId==dataTypeEnums.UNIQUE_ID||allowedGroup.canAdd),canEdit:utilities().boolToInt(allowedGroup.canEdit),canView:utilities().boolToInt(allowedGroup.canView),canDelete:utilities().boolToInt(allowedGroup.canDelete)},fieldPermArray.push(thisPerm)})),1==thisField.required&&1==thisField.restrictAccess){var canAddItems=fieldPermArray.filter(x=>1==x.canAdd);0!=canAddItems.length&&null!=canAddItems||(window.upsertRequestTypeNotification.update({title:`Request field "${$(this).find("select.savedFieldDropdown option:selected").html()}" is required but no users or groups have the "Add" permission.`,message:"",type:"danger"}),reject())}thisField.requestItemTypeFieldsPermissions=fieldPermArray}var dropdownRelations=$(this).attr("dropdownrelations");thisField.requestItemTypeFieldDropDownDependencies=void 0!==dropdownRelations?JSON.parse(dropdownRelations):[],typeFieldsArray.push(thisField)}));var frozenColumnsLeftValue=parseInt(editor.find('[fieldid="frozenColumnsLeft"] input[type="number"]').val());if(isNaN(frozenColumnsLeftValue)&&(frozenColumnsLeftValue=0),frozenColumnsLeftValue>typeFieldsArray.length)window.upsertRequestTypeNotification.update({title:"Error!",message:"The number of frozen columns cannot exceed the total number of fields on this table!",type:"danger"});else if(frozenColumnsLeftValue<0)window.upsertRequestTypeNotification.update({title:"Error!",message:"The number of frozen columns must not be negative!",type:"danger"});else{data={appName:"Configuration",requestItemType:{id:requestTypeId,displayName:requestTypeName,hoverText:editor.find('[fieldid="hoverText"] input[type="text"]').val(),restrictAccess:restrictAccess,requiresApproval:utilities().boolToInt(editor.find('[fieldid="requiresApproval"] input[type="checkbox"]').prop("checked")),disabled:utilities().boolToInt(editor.find('[fieldid="disabled"] input[type="checkbox"]').prop("checked")),isDefault:utilities().boolToInt(editor.find('[fieldid="isDefault"] input[type="checkbox"]').prop("checked")),searchRegForExistingCompound:utilities().boolToInt(editor.find('[fieldid="searchRegForExistingCompound"] input[type="checkbox"]').prop("checked")),registerNewCompounds:utilities().boolToInt(editor.find('[fieldid="registerNewCompounds"] input[type="checkbox"]').prop("checked")),frozenColumnsLeft:frozenColumnsLeftValue,requestItemTypePermissions:requestItemTypePermArray,requestItemTypeFields:typeFieldsArray}};var serviceObj={configService:!0};utilities().makeAjaxPost(configServiceEndpoints.REQUEST_ITEM_TYPES_UPSERT,data,serviceObj).then((function(response){console.log(response),resolve(response)})).catch((function(response){console.log("error"),notificationTitle=requestTypeId?"Failed to update "+reqTypeOrReqItemTypeNotificationText+' "'+requestTypeName+'".':'Failed to create new "'+reqTypeOrReqItemTypeNotificationText+' "'+requestTypeName+'".',window.upsertRequestTypeNotification.update({title:notificationTitle,message:"",type:"danger"})}))}}))},submitRequestTypeEditor=function(){return new Promise((function(resolve,reject){editor=$(".dropdownEditorContainer");var requestTypeName=editor.find('[fieldid="displayName"] input[type="text"]').val();if("requestTypes"==window.requestTypePageMode)var reqTypeOrReqItemTypeNotificationText="request type";else var reqTypeOrReqItemTypeNotificationText="request item type";if(""!==editor.attr("requesttypeid"))var notificationTitle="Updating "+reqTypeOrReqItemTypeNotificationText+' "'+requestTypeName+'"...';else var notificationTitle="Creating new "+reqTypeOrReqItemTypeNotificationText+' "'+requestTypeName+'"...';window.upsertRequestTypeNotification=$.notify({title:notificationTitle,message:""},{delay:0,type:"yellowNotification"});var requestTypeId=""!==editor.attr("requesttypeid")?parseInt(editor.attr("requesttypeid")):0,requestTypePermArray=[];let restrictAccess,permissionTypesList;if($.each(editor.find(".allowedUsers > button"),(function(){var userId=parseInt($(this).attr("userid"));allowedUser={requestTypeId:requestTypeId,allowedUserId:userId,allowedGroupId:null,canAdd:utilities().boolToInt($(".CanAddCheckbox[userId="+userId+"]").prop("checked")),canView:utilities().boolToInt($(".CanViewCheckbox[userId="+userId+"]").prop("checked")),canEdit:utilities().boolToInt($(".CanEditCheckbox[userId="+userId+"]").prop("checked")),canDelete:utilities().boolToInt($(".CanDeleteCheckbox[userId="+userId+"]").prop("checked")),canBeAssigned:utilities().boolToInt($(".CanBeAssignedCheckbox[userId="+userId+"]").prop("checked"))},requestTypePermArray.push(allowedUser)})),$.each(editor.find(".allowedGroups > button"),(function(){var groupId=parseInt($(this).attr("groupid"));allowedGroup={requestTypeId:requestTypeId,allowedUserId:null,allowedGroupId:groupId,canAdd:utilities().boolToInt($(".CanAddCheckbox[groupId="+groupId+"]").prop("checked")),canView:utilities().boolToInt($(".CanViewCheckbox[groupId="+groupId+"]").prop("checked")),canEdit:utilities().boolToInt($(".CanEditCheckbox[groupId="+groupId+"]").prop("checked")),canDelete:utilities().boolToInt($(".CanDeleteCheckbox[groupId="+groupId+"]").prop("checked")),canBeAssigned:utilities().boolToInt($(".CanBeAssignedCheckbox[groupId="+groupId+"]").prop("checked"))},requestTypePermArray.push(allowedGroup)})),1==utilities().boolToInt(editor.find('[fieldid="restrictAccess"] input[type="checkbox"]').prop("checked"))&&!checkIfAnyPermissions(requestTypePermArray,["canAdd","canView","canEdit","canDelete"]))return window.upsertRequestTypeNotification.update({title:"There are no permissions set on this restricted request type.",message:"Please select permissions to continue.",type:"danger"}),void reject();notificationSettingArray=[],$.each(editor.find("table#requestTypeReprioritizationNotificationsTable tbody tr"),(function(){groupSetting={requestTypeId:requestTypeId,groupId:parseInt($(this).attr("groupid")),notifyByEmail:utilities().boolToInt($(this).find(".notifyByEmailCheckbox").prop("checked"))},notificationSettingArray.push(groupSetting)}));let restrictionsArray=[],restrictedAppIdVal=$("#requestTypeAllowedAppsSelect").val();Array.isArray(restrictedAppIdVal)?restrictedAppIdVal&&(restrictionsArray=restrictedAppIdVal.map(appId=>({requestTypeId:requestTypeId,appId:appId}))):restrictionsArray.push({requestTypeId:requestTypeId,appId:restrictedAppIdVal});var typeFieldsArray=[];$.each(editor.find("table#requestTypeFieldsTable > tbody > tr"),(function(requestTypeFieldIndex){requestTypeFieldId=0,$(this).attr("requesttypefieldid")&&(requestTypeFieldId=$(this).attr("requesttypefieldid")),savedFieldId=$(this).find("select.savedFieldDropdown option:selected").attr("savedfieldid");var dataTypeId=parseInt($(this).attr("datatypeid")),defaultValue="",defaultValueJson={},defaultValueAttr=$(this).attr("defaultvaluejson");defaultValueAttr&&(defaultValueJson=JSON.parse(defaultValueAttr)),$.inArray(dataTypeId,[dataTypeEnums.TEXT,dataTypeEnums.LONG_TEXT,dataTypeEnums.INTEGER,dataTypeEnums.REAL_NUMBER,dataTypeEnums.DROP_DOWN])>-1&&defaultValueJson.company&&(defaultValue=defaultValueJson.company);var requestTypeFieldDefaultValuesByGroupArray=packageDefaultValuesForSubmission(defaultValueJson,"group"),requestTypeFieldDefaultValuesByUserArray=packageDefaultValuesForSubmission(defaultValueJson,"user");fieldGroup=null,""!==$(this).find("td.requestTypeFieldGroupTD select.fieldGroupDropdown").val()&&(fieldGroup=parseInt($(this).find("td.requestTypeFieldGroupTD select.fieldGroupDropdown").val())+1);var includeInManageRequests=$(this).find("td.requestTypeIncludeInTableTD > input").prop("checked"),filterValue;if(0!=$(this).find("#SortDropDown").length?filterValue=$($(this).find("#SortDropDown")[0]).val():0!=$(this).find("#SortLabel").length&&(filterValue=$($(this).find("#SortLabel")[0]).val()),filterValue=filterValue||null,null!=$(this).attr("requestTypeFieldNotificationGroupSettings"))var requestTypeFieldNotificationGroupSettings=utilities().parseJsons($(this).attr("requestTypeFieldNotificationGroupSettings").split("|||")),requestTypeFieldNotificationOtherUserSettings=utilities().parseJsons($(this).attr("requestTypeFieldNotificationOtherUserSettings").split("|||")),requestTypeFieldNotificationUserSettings=utilities().parseJsons($(this).attr("requestTypeFieldNotificationUserSettings").split("|||"));else var requestTypeFieldNotificationGroupSettings=[],requestTypeFieldNotificationOtherUserSettings=[],requestTypeFieldNotificationUserSettings=[];var biDirectionalLink=checkForNewBidirectionalField(requestTypeFieldId,dataTypeId)?1:utilities().boolToInt("true"==$(this).attr("biDirectinalLink"));let fieldCustAttrListStr=$(this).attr("requestTypeFieldCustomAttributeValues"),fieldCustAttrList=[];fieldCustAttrListStr&&(fieldCustAttrList=JSON.parse(fieldCustAttrListStr),fieldCustAttrList.forEach((function(attr){if(!("vendorAttributeId"in attr)){let vendorAttr=mapCustAttrIdToVendorAttr(custAttrDefList,attr.requestTypeCustAttribDefId,!0);if(vendorAttr&&(attr.vendorAttributeId=vendorAttr.vendorAttributeId,vendorAttr.displayDataType==CUST_ATTR_DATA_TYPES.DROP_DOWN)){let optionDefId=attr.requestTypeCustAttribDropdownOptDefId,optionDef=vendorAttr.requestTypeCustomAttributeDropDownOptionDefinitionList.find(x=>x.id==optionDefId);optionDef&&(attr.dropDownValue=optionDef.optionKey)}}})));var thisField={id:requestTypeFieldId,fieldId:savedFieldId,required:utilities().boolToInt(parseInt($(this).attr("isrequired"))),allowMultiple:utilities().boolToInt(parseInt($(this).attr("allowmultiple"))),disabled:utilities().boolToInt(parseInt($(this).attr("isdisabled"))),sortOrder:requestTypeFieldIndex+1,restrictAccess:utilities().boolToInt(parseInt($(this).attr("restrictaccess"))),inRequestsTable:utilities().boolToInt(includeInManageRequests),defaultValue:defaultValue,requestTypeFieldDefaultValuesByGroups:requestTypeFieldDefaultValuesByGroupArray,requestTypeFieldDefaultValuesByUsers:requestTypeFieldDefaultValuesByUserArray,fieldGroup:fieldGroup,clearWhenDuplicate:dataTypeId==dataTypeEnums.UNIQUE_ID?1:utilities().boolToInt(parseInt($(this).attr("clearWhenDuplicate"))),filterField:utilities().boolToInt($(this).find("input[type=radio]").prop("checked")),filterValue:filterValue,autoGenerateNotebook:utilities().boolToInt("true"==$(this).attr("autoGenNotebook")),autoGenerateExperiment:utilities().boolToInt("true"==$(this).attr("autoGenExperement")),autoGenerateProject:utilities().boolToInt("true"==$(this).attr("autoGenProject")),bidirectionalRequestLinking:biDirectionalLink,sendToELN:utilities().boolToInt($(this).attr("sendToELN")),requestTypeFieldNotificationGroupSettings:requestTypeFieldNotificationGroupSettings,requestTypeFieldNotificationOtherUserSettings:requestTypeFieldNotificationOtherUserSettings,requestTypeFieldNotificationUserSettings:requestTypeFieldNotificationUserSettings,requestTypeFieldCustomAttributeValues:fieldCustAttrList};if($(this)[0].hasAttribute("priorityoptions")&&(thisField.requestTypeFieldPriorityOptions=JSON.parse($(this).attr("priorityoptions"))),fieldPermArray=[],$(this).attr("restrictaccesssettings")){var restrictAccessSettingsObject=JSON.parse($(this).attr("restrictaccesssettings")),allowedUsers=restrictAccessSettingsObject.users,allowedGroups=restrictAccessSettingsObject.groups;if(allowedUsers&&$.each(allowedUsers,(function(userIndex,allowedUser){thisPerm={requestTypeFieldId:requestTypeId,allowedUserId:allowedUser.userId,allowedGroupId:null,canAdd:utilities().boolToInt(dataTypeId==dataTypeEnums.UNIQUE_ID||allowedUser.canAdd),canEdit:utilities().boolToInt(allowedUser.canEdit),canView:utilities().boolToInt(allowedUser.canView),canDelete:utilities().boolToInt(allowedUser.canDelete),onlyNotifyRequestor:0},fieldPermArray.push(thisPerm)})),allowedGroups&&$.each(allowedGroups,(function(userIndex,allowedGroup){thisPerm={requestTypeFieldId:requestTypeId,allowedUserId:null,allowedGroupId:allowedGroup.groupId,canAdd:utilities().boolToInt(dataTypeId==dataTypeEnums.UNIQUE_ID||allowedGroup.canAdd),canEdit:utilities().boolToInt(allowedGroup.canEdit),canView:utilities().boolToInt(allowedGroup.canView),canDelete:utilities().boolToInt(allowedGroup.canDelete)},fieldPermArray.push(thisPerm)})),1==thisField.required&&1==thisField.restrictAccess){var canAddItems=fieldPermArray.filter(x=>1==x.canAdd);0!=canAddItems.length&&null!=canAddItems||(window.upsertRequestTypeNotification.update({title:`Request field "${$(this).find("select.savedFieldDropdown option:selected").html()}" is required but no users or groups have the "Add" permission.`,message:"",type:"danger"}),reject())}thisField.requestTypeFieldsPermissions=fieldPermArray}var dropdownRelations=$(this).attr("dropdownrelations");thisField.requestTypeFieldDropDownDependencies=void 0!==dropdownRelations?JSON.parse(dropdownRelations):[],typeFieldsArray.push(thisField)}));var typeItemsArray=[];window.requestItemTypesArray.length>0&&$.each(editor.find("table#requestTypeRequestItemTypesTable > tbody > tr"),(function(requestTypeItemsIndex){var requestItemId=0;if($(this).attr("requestitemid")&&(requestItemId=parseInt($(this).attr("requestitemid"))),null!=$(this).attr("requestTypeItemFieldNotificationGroupSettings"))var requestTypeItemFieldNotificationGroupSettings=utilities().parseJsons($(this).attr("requestTypeItemFieldNotificationGroupSettings").split("|||")),requestTypeItemFieldNotificationOtherUserSettings=utilities().parseJsons($(this).attr("requestTypeItemFieldNotificationOtherUserSettings").split("|||")),requestTypeItemFieldNotificationUserSettings=utilities().parseJsons($(this).attr("requestTypeItemFieldNotificationUserSettings").split("|||")),requestTypeItemNotificationGroupSettings=utilities().parseJsons($(this).attr("requestTypeItemNotificationGroupSettings").split("|||")),requestTypeItemNotificationOtherUserSettings=utilities().parseJsons($(this).attr("requestTypeItemNotificationOtherUserSettings").split("|||")),requestTypeItemNotificationUserSettings=utilities().parseJsons($(this).attr("requestTypeItemNotificationUserSettings").split("|||"));else var requestTypeItemFieldNotificationGroupSettings=[],requestTypeItemFieldNotificationOtherUserSettings=[],requestTypeItemFieldNotificationUserSettings=[],requestTypeItemNotificationGroupSettings=[],requestTypeItemNotificationOtherUserSettings=[],requestTypeItemNotificationUserSettings=[];var thisTypeItem={id:requestItemId,requestTypeId:requestTypeId,requestItemTypeId:$(this).find("select.requestType_requestItemTypeDropdown option:selected").attr("requestitemtypeid"),requestItemName:$(this).find('input[type="text"].requestType_requestItemCustomName').val(),requestItemMinimumCount:$(this).find('input[type="text"].requestType_requestItemMinimumCount').val(),deleteOnEdit:$(this).find('input[type="checkbox"].centerAlign').prop("checked"),requestTypeItemFieldNotificationGroupSettings:requestTypeItemFieldNotificationGroupSettings,requestTypeItemFieldNotificationOtherUserSettings:requestTypeItemFieldNotificationOtherUserSettings,requestTypeItemFieldNotificationUserSettings:requestTypeItemFieldNotificationUserSettings,requestTypeItemNotificationGroupSettings:requestTypeItemNotificationGroupSettings,requestTypeItemNotificationOtherUserSettings:requestTypeItemNotificationOtherUserSettings,requestTypeItemNotificationUserSettings:requestTypeItemNotificationUserSettings};console.log(requestTypeItemsIndex),typeItemsArray.push(thisTypeItem)}));var hasDuplicate=!1;if(typeItemsArray.map(x=>x.requestItemTypeId).sort().sort((a,b)=>{a===b&&(hasDuplicate=!0)}),hasDuplicate)return window.upsertRequestTypeNotification.update({title:"Error",message:"Cannot have duplicate request items",type:"danger"}),!1;var frozenColumnsLeftValue=parseInt(editor.find('[fieldid="frozenColumnsLeft"] input[type="number"]').val());isNaN(frozenColumnsLeftValue)&&(frozenColumnsLeftValue=0);var reqNameRequestTypeFieldId=$("#requestNameSelectField").attr("saveditem");reqNameRequestTypeFieldId=0==reqNameRequestTypeFieldId?null:reqNameRequestTypeFieldId;var NameOrdersS=new Set,check=4;if(isNaN(parseInt($("#staticNameSortOrder").val()))?check-=1:NameOrdersS.add(parseInt($("#staticNameSortOrder").val())),isNaN(parseInt($("#groupSortOrder").val()))?check-=1:NameOrdersS.add(parseInt($("#groupSortOrder").val())),isNaN(parseInt($("#fieldInNameSortOrder").val()))?check-=1:NameOrdersS.add(parseInt($("#fieldInNameSortOrder").val())),isNaN(parseInt($("#incromentingNumSortOrder").val()))?check-=1:NameOrdersS.add(parseInt($("#incromentingNumSortOrder").val())),NameOrdersS.size!=check)return window.upsertRequestTypeNotification.update({title:"Request names cannot have 2 values at the same position.",message:"",type:"danger"}),void reject(!0);try{var requesttypenotificationgroupsettings=utilities().parseJsons($("#configRequestNotifications").attr("requesttypenotificationgroupsettings").split("|||")),requesttypenotificationusersettings=utilities().parseJsons($("#configRequestNotifications").attr("requesttypenotificationusersettings").split("|||")),requesttypenotificationotherusersettings=utilities().parseJsons($("#configRequestNotifications").attr("requesttypenotificationotherusersettings").split("|||"))}catch(e){var requesttypenotificationgroupsettings=null,requesttypenotificationusersettings=null,requesttypenotificationotherusersettings=null}let requestTypeCustomAttributeValues=getCustAttrValList("requestTypeCustomAttributesTable","requestTypeId",requestTypeId);data={appName:"Configuration",requestType:{id:requestTypeId,displayName:requestTypeName,hoverText:editor.find('[fieldid="hoverText"] input[type="text"]').val(),restrictAccess:utilities().boolToInt(editor.find('[fieldid="restrictAccess"] input[type="checkbox"]').prop("checked")),requiresApproval:utilities().boolToInt(editor.find('[fieldid="requiresApproval"] input[type="checkbox"]').prop("checked")),disabled:utilities().boolToInt(editor.find('[fieldid="disabled"] input[type="checkbox"]').prop("checked")),isDefault:utilities().boolToInt(editor.find('[fieldid="isDefault"] input[type="checkbox"]').prop("checked")),frozenColumnsLeft:frozenColumnsLeftValue,notifyColabs:utilities().boolToInt(editor.find('[fieldid="colabNotification"] input[type="checkbox"]').prop("checked")),showPrioritizationOnSubmit:utilities().boolToInt(editor.find('[fieldid="showPrioritizationOnSubmit"] input[type="checkbox"]').prop("checked")),searchRegForExistingCompound:utilities().boolToInt(editor.find('[fieldid="searchRegForExistingCompound"] input[type="checkbox"]').prop("checked")),registerNewCompounds:utilities().boolToInt(editor.find('[fieldid="registerNewCompounds"] input[type="checkbox"]').prop("checked")),checkIfStructIsRequestedBeforeReg:utilities().boolToInt(editor.find('[fieldid="checkIfStructIsRequestedBeforeReg"] input[type="checkbox"]').prop("checked")),requestRestrictions:restrictionsArray,requestTypePermissions:requestTypePermArray,requestTypeFields:typeFieldsArray,requestTypeItems:typeItemsArray,reqNamePrefix:$("#staticNameString").val(),reqNamePrefixOrder:isNaN(parseInt($("#staticNameSortOrder").val()))?0:parseInt($("#staticNameSortOrder").val()),reqNameUseUserGroupId:utilities().boolToInt($("#useAssignedGroup").prop("checked")),reqNameUseUserGroupIdOrder:isNaN(parseInt($("#groupSortOrder").val()))?0:parseInt($("#groupSortOrder").val()),reqNameRequestTypeFieldId:reqNameRequestTypeFieldId,reqNameRequestTypeFieldIdOrder:isNaN(parseInt($("#fieldInNameSortOrder").val()))?0:parseInt($("#fieldInNameSortOrder").val()),reqNameUseIncrementingNumbersCode:$("#selectIncromentingNum").val(),reqNameUseIncrementingNumbersCodeOrder:isNaN(parseInt($("#incromentingNumSortOrder").val()))?0:parseInt($("#incromentingNumSortOrder").val()),requesttypenotificationgroupsettings:requesttypenotificationgroupsettings,requesttypenotificationusersettings:requesttypenotificationusersettings,requesttypenotificationotherusersettings:requesttypenotificationotherusersettings,requestTypeCustomAttributeDefinitions:custAttrDefList,requestTypeCustomAttributeValues:requestTypeCustomAttributeValues}};var serviceObj={configService:!0};utilities().makeAjaxPost(configServiceEndpoints.REQUEST_TYPES_UPSERT,data,serviceObj).then((function(response){console.log(response),resolve(response)})).catch((function(response){console.log("error"),notificationTitle=requestTypeId?"Failed to update "+reqTypeOrReqItemTypeNotificationText+' "'+requestTypeName+'".':'Failed to create new "'+reqTypeOrReqItemTypeNotificationText+' "'+requestTypeName+'".',window.upsertRequestTypeNotification.update({title:notificationTitle,message:"",type:"danger"})}))}))},packageDefaultValuesForSubmission=function(defaultValueJson,level){var defaultValuesArray=[];for(id in defaultValueJson[level]){var valueField={requestTypeFieldId:requestTypeFieldId,defaultValue:defaultValueJson[level][id]};valueField[`${level}Id`]=id,defaultValuesArray.push(valueField)}return defaultValuesArray},checkForNewBidirectionalField=function(requestTypeFieldId,dataTypeId){return 0==requestTypeFieldId&&[dataTypeEnums.NOTEBOOK,dataTypeEnums.PROJECT,dataTypeEnums.EXPERIMENT].includes(dataTypeId)},addRequestTypeFieldToEditor=function(requestTypeField,alwaysAllowDelete,ignoreRequestTypeFieldId){var tableRow=$("<tr></tr>"),grabHandle=$("<td></td>").append("<i class='material-icons editRequestTypeDrag' title='Drag Handle'>reorder</i>"),savedFieldDropdownTD=$('<td class="savedFieldDropdownTD"></td>').append('<select class="savedFieldDropdown"></select>'),requestTypeFieldGroupTD=$('<td class="requestTypeFieldGroupTD">').append(fieldGroupsDropdown.clone()),requestTypeIncludeInTableTD=$('<td class="requestTypeIncludeInTableTD">').append('<input type="checkbox"></input>'),requestTypeFieldOptionsTD=$("<td></td>").append('<button class="basicActionButton manageFieldOptionsButton">Edit</button>'),requestTypeFieldDeleteButtonTD=$("<td></td>").append('<button class="editorSectionTableRowDeleteButton">Delete</button>'),requestTypeFieldSortBtn=$("<td></td>").append("<input type='radio' class='RadioAlign centerAlign alignMiddle' name='SortSelect'/>");if("requestItemTypes"==requestTypePageMode&&requestTypeFieldSortBtn.addClass("hide"),savedFieldDropdownTD.find("select").html(window.savedFieldsOptionsHTML),requestTypeField){if(console.log(requestTypeField),ignoreRequestTypeFieldId||tableRow.attr("requesttypefieldid",requestTypeField.requestTypeFieldId),savedFieldDropdownTD.find("select").attr("disabled","disabled"),savedFieldDropdownTD.find("select").addClass("disabledSavedField"),tableRow.attr("savedFieldId",requestTypeField.savedFieldId),savedFieldDropdownTD.find('option[savedfieldid="'+requestTypeField.savedFieldId+'"]').prop("selected",!0),tableRow.attr("isrequired",requestTypeField.required),tableRow.attr("allowmultiple",requestTypeField.allowMultiple),tableRow.attr("isdisabled",requestTypeField.disabled),void 0!==requestTypeField.restrictAccess&&tableRow.attr("restrictaccess",requestTypeField.restrictAccess),tableRow.attr("autoGenNotebook",1==requestTypeField.autoGenerateNotebook),tableRow.attr("autoGenProject",1==requestTypeField.autoGenerateProject),tableRow.attr("autoGenExperement",1==requestTypeField.autoGenerateExperement),tableRow.attr("biDirectinalLink",1==requestTypeField.bidirectionalRequestLinking),tableRow.attr("sendToELN",1==requestTypeField.sendToELN),"requestTypes"==window.requestTypePageMode){var isFilterField=requestTypeField.requestTypeFieldPriorityOptions.length>0?"1":"0";tableRow.attr("priorityOptions",JSON.stringify(requestTypeField.requestTypeFieldPriorityOptions)),tableRow.attr("filterField",isFilterField),tableRow.attr("requestTypeFieldNotificationGroupSettings",stringNotifications(requestTypeField.requestTypeFieldNotificationGroupSettings)),tableRow.attr("requestTypeFieldNotificationUserSettings",stringNotifications(requestTypeField.requestTypeFieldNotificationUserSettings)),tableRow.attr("requestTypeFieldNotificationOtherUserSettings",stringNotifications(requestTypeField.requestTypeFieldNotificationOtherUserSettings)),tableRow.attr("requestTypeFieldCustomAttributeValues",JSON.stringify(requestTypeField.requestTypeFieldCustomAttributeValues))}if(requestTypeField.dataTypeId==dataTypeEnums.DROP_DOWN){if("1"==isFilterField)$($(requestTypeFieldSortBtn).children()[0]).prop("checked",!0);else if(requestTypeField.dataTypeId==dataTypeEnums.DROP_DOWN){var dependencyField="requestTypeFieldDropDownDependencies";"requestItemTypes"==requestTypePageMode&&(dependencyField="requestItemTypeFieldDropDownDependencies"),tableRow.attr("dropdownrelations",JSON.stringify(requestTypeField[dependencyField]))}}else requestTypeFieldSortBtn.empty();tableRow.attr("clearWhenDuplicate",requestTypeField.clearWhenDuplicate),void 0!==requestTypeField.allowedUsers&&void 0!==requestTypeField.allowedGroups&&tableRow.attr("restrictaccesssettings",JSON.stringify({users:requestTypeField.allowedUsers,groups:requestTypeField.allowedGroups})),tableRow.attr("inrequeststable",requestTypeField.inRequestsTable),$($(requestTypeIncludeInTableTD).children()[0]).prop("checked",requestTypeField.inRequestsTable),"requestItemTypes"==window.requestTypePageMode&&(requestTypeIncludeInTableTD=$("<td></td>")),requestTypeField.dataTypeId==dataTypeEnums.BIOSPIN_EDITOR&&$("requestTypeIncludeInTableTD").prop("disabled",!0),alwaysAllowDelete||requestTypeFieldDeleteButtonTD.empty()}tableRow.append(grabHandle,savedFieldDropdownTD,requestTypeFieldGroupTD,requestTypeIncludeInTableTD,requestTypeFieldOptionsTD,requestTypeFieldDeleteButtonTD,requestTypeFieldSortBtn),updateRequestTypeFieldSavedFieldChoice(tableRow),requestTypeField&&(requestTypeField.defaultValue&&$.inArray(requestTypeField.dataTypeId,[dataTypeEnums.TEXT,dataTypeEnums.LONG_TEXT,dataTypeEnums.INTEGER,dataTypeEnums.REAL_NUMBER,dataTypeEnums.DROP_DOWN])>-1&&tableRow.attr("defaultvalue",requestTypeField.defaultValue),requestTypeField.fieldGroup&&(tableRow.find('select.fieldGroupDropdown option[value="'+(requestTypeField.fieldGroup-1)+'"]').prop("selected",!0).change(),tableRow.attr("fieldgroup",requestTypeField.fieldGroup))),$("table#requestTypeFieldsTable > tbody").append(tableRow)},populateRequestItemReprioritizationNotificationsContainer=function(requestItemTypeRowElement){requestItemName=requestItemTypeRowElement.find(".requestType_requestItemCustomName").val(),$('#reprioritizationRequestItemTypeNotificationSettingsModal table.requestItemReprioritizationNotificationsTable input[type="checkbox"]').prop("checked",!1),$(".notificationsContainerTitle .reprioritizationRequestItemTypeNameContainer").text(requestItemName+"s")},addRequestItemTypeToEditor=function(requestType_requestItemType,alwaysAllowDelete,ignoreRequestTypeFieldId){var tableRow=$("<tr></tr>"),requestType_requestItemTypeDropdownTD=$("<td></td>").append('<select class="requestType_requestItemTypeDropdown"></select>'),requestType_requestItemCustomNameTD=$("<td></td>").append('<input type="text" class="requestType_requestItemCustomName">'),requestType_requestItemMinimumCountTD=$("<td></td>").append('<input type="text" class="requestType_requestItemMinimumCount" value="0">'),requestType_requestItemDeleteOnEditCB=$("<td></td>").append('<input type="checkbox" class="centerAlign"/>'),requestType_requestItemDeleteButtonTD=$("<td></td>").append('<button class="editorSectionTableRowDeleteButton">Delete</button>');requestType_requestItemTypeDropdownTD.find("select").html(window.requestItemTypesOptionsHTML),requestType_requestItemType&&(ignoreRequestTypeFieldId||tableRow.attr("requestitemid",requestType_requestItemType.requestItemId),requestType_requestItemTypeDropdownTD.find('option[requestitemtypeid="'+requestType_requestItemType.requestItemTypeId+'"]').prop("selected",!0),alwaysAllowDelete||requestType_requestItemDeleteButtonTD.empty(),requestType_requestItemCustomNameTD.find('input[type="text"].requestType_requestItemCustomName').val(requestType_requestItemType.requestItemName),requestType_requestItemType.requestItemMinimumCount&&requestType_requestItemMinimumCountTD.find('input[type="text"].requestType_requestItemMinimumCount').val(requestType_requestItemType.requestItemMinimumCount),"requestTypes"==window.requestTypePageMode&&(tableRow.attr("requestTypeItemFieldNotificationGroupSettings",stringNotifications(requestType_requestItemType.requestTypeItemFieldNotificationGroupSettings)),tableRow.attr("requestTypeItemFieldNotificationUserSettings",stringNotifications(requestType_requestItemType.requestTypeItemFieldNotificationUserSettings)),tableRow.attr("requestTypeItemFieldNotificationOtherUserSettings",stringNotifications(requestType_requestItemType.requestTypeItemFieldNotificationOtherUserSettings)),tableRow.attr("requestTypeItemNotificationGroupSettings",stringNotifications(requestType_requestItemType.requestTypeItemNotificationGroupSettings)),tableRow.attr("requestTypeItemNotificationUserSettings",stringNotifications(requestType_requestItemType.requestTypeItemNotificationUserSettings)),tableRow.attr("requestTypeItemNotificationOtherUserSettings",stringNotifications(requestType_requestItemType.requestTypeItemNotificationOtherUserSettings))),1==requestType_requestItemType.deleteOnEdit&&$($(requestType_requestItemDeleteOnEditCB).children()).prop("checked",!0)),tableRow.append(requestType_requestItemTypeDropdownTD,requestType_requestItemCustomNameTD,requestType_requestItemMinimumCountTD,requestType_requestItemDeleteOnEditCB,requestType_requestItemDeleteButtonTD),$("table#requestTypeRequestItemTypesTable > tbody").append(tableRow)},populateRequestTypesTable=function(asOfDate=null){$.fn.DataTable.isDataTable("#dropdownsTable")&&($("#dropdownsTable").DataTable().destroy(),$("#dropdownsTable").empty());var dataTable=$("#dropdownsTable").DataTable({processing:!0,scrollX:!0,language:{loadingRecords:"",zeroRecords:"",emptyTable:"",processing:"<div class='blueLoadingSpinner'></div><br>Loading..."},ajax:function(data,callback,settings){var requestTypePromises=[];requestTypePromises.push(getRequestTypes(asOfDate)),requestTypePromises.push(getRequestItemTypes(asOfDate)),Promise.all(requestTypePromises).then((function(){var rows=[];$.each(window.pageModeRequestTypes,(function(index,requestType){requestType.fieldsDict=ajaxModule().makeFieldsDict(requestType.fields);var datarow=[];datarow.push(requestType.displayName),datarow.push(requestType.hoverText);var fieldNamesArray=[];$.each(window.savedFieldsArray,(function(savedFieldIndex,savedField){$.each(Object.keys(requestType.fieldsDict),(function(fieldIndex,fieldId){var field=requestType.fieldsDict[fieldId][0];if(void 0!==field&&savedField.id==field.savedFieldId)return fieldNamesArray.push(savedField.displayName),!1}))})),datarow.push(fieldNamesArray.join(", "));var requestTypeRestrictAccesss=requestType.restrictAccess?"True":"False";datarow.push(requestTypeRestrictAccesss);var requestTypeRequiresApproval=requestType.requiresApproval?"True":"False";datarow.push(requestTypeRequiresApproval);var requestTypeIsDefault=requestType.isDefault?"True":"False";datarow.push(requestTypeIsDefault);var requestTypeDisabled=requestType.disabled?"Disabled":"Enabled";datarow.push(requestTypeDisabled),datarow.push(requestType.id),rows.push(datarow)})),callback(rows),$(".dropdownsTable").width($("div.col-sm-12").width())})),settings.sAjaxDataProp=""},columnDefs:[{targets:2,width:"700px"}]})},getRequestTypes=function(asOfDate=null){return new Promise((function(resolve,reject){var requestTypeParams={includeDisabled:!0,isConfigPage:!0,appName:"Configuration",asOfDate:utilities().getDateForService(asOfDate)};ajaxModule().getRequestTypes(requestTypeParams).then((function(response){response=utilities().decodeServiceResponce(response),window.requestTypesArray=response.map((function(x){return x.fields=utilities().sortArray(x.fields,"sortOrder"),x})),"requestTypes"==window.requestTypePageMode&&(window.pageModeRequestTypes=window.requestTypesArray),resolve(!0)}))}))},getRequestItemTypes=function(asOfDate){return new Promise((function(resolve,reject){var requestItemTypesParams={includeDisabled:!0,isConfigPage:!0,appName:"Configuration",asOfDate:utilities().getDateForService(asOfDate)};ajaxModule().getRequestItemTypes(requestItemTypesParams).then((function(response){response=utilities().decodeServiceResponce(response),window.requestItemTypesArray=response.map((function(x){return x.fields=utilities().sortArray(x.fields,"sortOrder"),x})),"requestItemTypes"==window.requestTypePageMode&&(window.pageModeRequestTypes=response),resolve(!0)}))}))},populateDataTypes=function(){return new Promise((function(resolve,reject){$("select#dataTypeDropdown").empty(),$.each(window.dataTypesArray,(function(index,dataType){var dataTypeOption=$("<option></option>").attr("value",dataType.id).text(dataType.displayName);$("select#dataTypeDropdown").append(dataTypeOption)})),resolve(!0)}))},updateRequestItemNotificationSettingsContainerAttribute=function(){return notificationSettingsObject={},$("#requestItemReprioritizationNotificationsEditorSection").attr("notificationsettings")&&(notificationSettingsObject=JSON.parse($("#requestItemReprioritizationNotificationsEditorSection").attr("notificationsettings"))),groupsArray=[],$.each($("#reprioritizationRequestItemTypeNotificationSettingsModal").find("table#requestItemReprioritizationNotificationsTable tbody tr"),(function(){group={groupId:parseInt($(this).attr("groupid")),notifyByEmail:$(this).find(".notifyByEmailCheckbox").prop("checked")},groupsArray.push(group)})),notificationSettingsObject.groups=groupsArray,notificationSettingsObject},updateRequestTypeFieldSavedFieldChoice=function(tableRow){var thisSavedField=window.savedFieldsArray.find(x=>x.id==parseInt(tableRow.find(".savedFieldDropdown option:selected").attr("savedfieldid")));if(tableRow.attr("savedfieldindex",tableRow.find("select.savedFieldDropdown").val()).attr("datatypeid",thisSavedField.dataTypeId.toString()),5==thisSavedField.dataTypeId){var dropdownOptionsArray=[];dropdownOptionsArray.push($('<option value="">').text("-- None --")),$.each(thisSavedField.options,(function(optionIndex,option){0==this.disabled&&dropdownOptionsArray.push($("<option>").attr("value",option.dropdownOptionId).text(option.displayName))})),tableRow.find("select.defaultValueDropdown").empty().append(dropdownOptionsArray)}thisSavedField.dataTypeId==dataTypeEnums.BIOSPIN_EDITOR?($(tableRow.find(".requestTypeIncludeInTableTD > input").attr("checked",!1)),$(tableRow.find(".requestTypeIncludeInTableTD > input").attr("disabled",!0))):$(tableRow.find(".requestTypeIncludeInTableTD > input").attr("disabled",!1))},submitRequestTypeFieldEditor=function(){var dropdownRelations=getDropdownRelationFromTable();if(!dropdownRelations)return swal("Warning!","There is a duplicate combination of source value and target value.","warning"),!1;if(dropdownRelations=={}){var requestTypeFieldId=$(window.requestTypeFieldEditorTableRow).attr("requesttypefieldid"),requestTypeId=$(".dropdownEditorContainer").attr("requesttypeid"),requestType=window.pageModeRequestTypes.find(x=>x.id==requestTypeId);if(void 0===requestType)return srcCol;var currField=requestType.fields.find(x=>x.requestTypeFieldId==requestTypeFieldId);if(void 0===currField)return srcCol;var savedFieldId=currField.savedFieldId;dropdownRelations=getExistingDropdownRelation(requestType,savedFieldId)}window.requestTypeFieldEditorTableRow.attr("isrequired",+$("#requestTypeFieldEditorModal").find("input.requestTypeFieldIsRequired").prop("checked")),window.requestTypeFieldEditorTableRow.attr("allowmultiple",+$("#requestTypeFieldEditorModal").find("input.requestTypeFieldAllowMultiple").prop("checked")),window.requestTypeFieldEditorTableRow.attr("isdisabled",+$("#requestTypeFieldEditorModal").find("input.requestTypeFieldIsDisabled").prop("checked")),window.requestTypeFieldEditorTableRow.attr("restrictaccess",+$("#requestTypeFieldEditorModal").find("input.requestTypeFieldRestrictAccess").prop("checked")),window.requestTypeFieldEditorTableRow.attr("clearWhenDuplicate",+$("#requestTypeFieldEditorModal").find("input.requestTypeFieldClearWhenDuplicate").prop("checked")),window.requestTypeFieldEditorTableRow.attr("autoGenNotebook",$("[fieldid = requestTypeFieldAutoGenNotebook]").find("input").prop("checked")),window.requestTypeFieldEditorTableRow.attr("autoGenProject",$("[fieldid = requestTypeFieldAutoGenProject]").find("input").prop("checked")),window.requestTypeFieldEditorTableRow.attr("autoGenExperement",$("[fieldid = requestTypeFieldAutoGenExperiment]").find("input").prop("checked")),window.requestTypeFieldEditorTableRow.attr("biDirectinalLink",$("[fieldid = requestTypeFieldBiDirectinalLink]").find("input").prop("checked")),window.requestTypeFieldEditorTableRow.attr("sendToELN",$("[fieldid = requestTypeFieldSendToELN]").find("input").prop("checked"));var requestTypeFieldRestrictionsContainer=$("#requestTypeFieldEditorModal").find(".requestTypeFieldRestrictionsContainer");allowedUsersArray=[],$.each(requestTypeFieldRestrictionsContainer.find("table#requestTypeFieldAllowedUsersTable tbody tr"),(function(){allowedUser={userId:parseInt($(this).attr("userid")),canAdd:$(this).find(".canAddCheckbox").prop("checked"),canView:$(this).find(".canViewCheckbox").prop("checked"),canEdit:$(this).find(".canEditCheckbox").prop("checked"),canDelete:$(this).find(".canDeleteCheckbox").prop("checked")},allowedUsersArray.push(allowedUser)})),allowedGroupsArray=[],$.each(requestTypeFieldRestrictionsContainer.find("table#requestTypeFieldAllowedGroupsTable tbody tr"),(function(){allowedGroup={groupId:parseInt($(this).attr("groupid")),canAdd:$(this).find(".canAddCheckbox").prop("checked"),canView:$(this).find(".canViewCheckbox").prop("checked"),canEdit:$(this).find(".canEditCheckbox").prop("checked"),canDelete:$(this).find(".canDeleteCheckbox").prop("checked")},allowedGroupsArray.push(allowedGroup)})),restrictAccessSettings={users:allowedUsersArray,groups:allowedGroupsArray},window.requestTypeFieldEditorTableRow.attr("restrictaccesssettings",JSON.stringify(restrictAccessSettings)),window.requestTypeFieldEditorTableRow.attr("notificationsettings",JSON.stringify(updateRequestTypeFieldNotificationSettingsContainerAttribute())),window.requestTypeFieldEditorTableRow.attr("inrequeststable",+$("td.requestTypeIncludeInTableTD").find("input").prop("checked")),dataTypeIdParsed=parseInt($("#requestTypeFieldEditorModal").attr("datatypeid"));var defaultValueJson=JSON.parse(window.requestTypeFieldEditorTableRow.attr("defaultvaluejson"));if($.inArray(dataTypeIdParsed,[dataTypeEnums.TEXT,dataTypeEnums.LONG_TEXT,dataTypeEnums.INTEGER,dataTypeEnums.REAL_NUMBER])>-1)defaultValueJson=packageDefaultValues(defaultValueJson,"input.defaultValueInput"),window.requestTypeFieldEditorTableRow.attr("defaultvalue",$("#requestTypeFieldEditorModal").find("input.defaultValueInput").val());else if(dataTypeIdParsed==dataTypeEnums.DROP_DOWN&&(defaultValueJson=packageDefaultValues(defaultValueJson,"select.defaultValueDropdown"),window.requestTypeFieldEditorTableRow.attr("defaultvalue",$("#requestTypeFieldEditorModal").find("select.defaultValueDropdown").val()),"1"==window.requestTypeFieldEditorTableRow.attr("filterField"))){var data=$("#filterValueManagmentTable").DataTable().data().toArray();data&&window.requestTypeFieldEditorTableRow.attr("priorityoptions",JSON.stringify(data))}window.requestTypeFieldEditorTableRow.attr("defaultvaluejson",JSON.stringify(defaultValueJson));let custAttrJson=getCustAttrValList("requestTypeFieldCustomAttributesTable");return window.requestTypeFieldEditorTableRow.attr("requesttypefieldcustomattributevalues",JSON.stringify(custAttrJson)),isNaN(parseInt($("#requestTypeFieldEditorModal").find("select.fieldGroupDropdown").val()))?window.requestTypeFieldEditorTableRow.attr("fieldgroup",null):(window.requestTypeFieldEditorTableRow.find('select.fieldGroupDropdown option[value="'+$("#requestTypeFieldEditorModal").find("select.fieldGroupDropdown").val()+'"]').prop("selected",!0),window.requestTypeFieldEditorTableRow.find("select.fieldGroupDropdown").change()),"No relation"==dropdownRelations&&(dropdownRelations={}),window.requestTypeFieldEditorTableRow.attr("dropdownrelations",JSON.stringify(dropdownRelations)),!0},packageDefaultValues=function(defaultValueJson,selector){for(levelKey in defaultValueJson)"company"!=levelKey?$.each($(`.${levelKey}DefaultsTabs`).find(".tabContent"),(function(i,tabContent){var id=$(tabContent).attr(`${levelKey}id`),defVal=$(tabContent).find(selector).val();defaultValueJson[levelKey][id]=defVal})):defaultValueJson[levelKey]=$("#requestTypeFieldEditorModal").find(`${selector}.company`).val();return defaultValueJson},populateRequestTypeFieldEditor=function(tableRow){window.requestTypeFieldEditorTableRow=tableRow,$('#requestTypeFieldEditorModal input[type="text"]').val(""),$('#requestTypeFieldEditorModal input[type="checkbox"]').prop("checked",!1),$("#requestTypeFieldEditorModal").attr("requesttypefieldid",tableRow.attr("requesttypefieldid")),$("#requestTypeFieldEditorModal").attr("isrequired",tableRow.attr("isrequired")),$("#requestTypeFieldEditorModal").attr("allowmultiple",tableRow.attr("allowmultiple")),$("#requestTypeFieldEditorModal").attr("isdisabled",tableRow.attr("isdisabled")),$("#requestTypeFieldEditorModal").attr("clearWhenDuplicate",tableRow.attr("clearWhenDuplicate")),$("#requestTypeFieldEditorModal").attr("restrictaccess",tableRow.attr("restrictaccess")),$("#requestTypeFieldEditorModal").attr("restrictaccesssettings",tableRow.attr("restrictaccesssettings")),$("#requestTypeFieldEditorModal").attr("notificationsettings",tableRow.attr("notificationsettings")),$("#requestTypeFieldEditorModal").attr("inrequeststable",tableRow.attr("inrequeststable")),$("#requestTypeFieldEditorModal").attr("savedfieldindex",tableRow.attr("savedfieldindex")),$("#requestTypeFieldEditorModal").attr("datatypeid",tableRow.attr("datatypeid"));var filterField="1"==tableRow.attr("filterField");$("[fieldid = requestTypeFieldAutoGenNotebook]").hide(),$("[fieldid = requestTypeFieldAutoGenProject]").hide(),$("[fieldid = requestTypeFieldAutoGenExperiment]").hide(),$("[fieldid = requestTypeFieldBiDirectinalLink]").hide(),$("[fieldid=requestTypeFieldSendToELN]").hide(),emptyDependencyTable(),$("#requestTypeFieldCustomAttributesTable > tbody").empty(),populateUserDefaultsTabs(),populateGroupDefaultsTabs();var thisSavedField=window.savedFieldsArray.find(x=>x.id==parseInt(tableRow.attr("savedfieldid"))),requestTypeId=$(".dropdownEditorContainer").attr("requesttypeid");if(""!=requestTypeId)var requestType=window.pageModeRequestTypes.find(x=>x.id==parseInt(requestTypeId));$("#requestTypeFieldEditorModal .modalTitleFixed").text(thisSavedField.displayName);var dataTypeIdParsed=parseInt(tableRow.attr("datatypeid"));if(dataTypeIdParsed==dataTypeEnums.DROP_DOWN&&filterField?$("#filterSection").show():$("#filterSection").hide(),dataTypeIdParsed==dataTypeEnums.DROP_DOWN){var dropdownOptionsArray=[];if($("#filterValueManagmentTable").show(),"requestTypes"==window.requestTypePageMode){var priorityOptions=tableRow.attr("priorityOptions");priorityOptions=priorityOptions?JSON.parse(priorityOptions):[],initFilterTable(thisSavedField.options,priorityOptions,tableRow.attr("requesttypefieldid"))}dropdownOptionsArray.push($('<option value="">').text("-- None --")),thisSavedField.options&&$.each(thisSavedField.options,(function(optionIndex,option){0==this.disabled&&dropdownOptionsArray.push($("<option>").attr("value",option.dropdownOptionId).text(option.displayName))})),$("#requestTypeFieldEditorModal").find("select.defaultValueDropdown").empty().append(dropdownOptionsArray)}else dataTypeIdParsed==dataTypeEnums.FILE_ATTACHMENT?($("[fieldid=requestTypeFieldSendToELN]").show(),$("[fieldid=requestTypeFieldSendToELN]").find("input").prop("checked","true"==tableRow.attr("sendToELN"))):13!=dataTypeIdParsed&&14!=dataTypeIdParsed&&15!=dataTypeIdParsed||(13==dataTypeIdParsed?($("[fieldid = requestTypeFieldAutoGenNotebook]").show(),$("[fieldid = requestTypeFieldAutoGenNotebook]").find("input").prop("checked","true"==tableRow.attr("autoGenNotebook"))):14==dataTypeIdParsed?($("[fieldid = requestTypeFieldAutoGenProject]").show(),$("[fieldid = requestTypeFieldAutoGenProject]").find("input").prop("checked","true"==tableRow.attr("autoGenProject"))):15==dataTypeIdParsed&&$("[fieldid = requestTypeFieldAutoGenExperiment]").find("input").prop("checked","true"==tableRow.attr("autoGenExperement")),$("[fieldid = requestTypeFieldBiDirectinalLink]").show(),$("[fieldid = requestTypeFieldBiDirectinalLink]").find("input").prop("checked","true"==tableRow.attr("biDirectinalLink")));$("#requestTypeFieldEditorModal .requestTypeFieldIsRequired").prop("checked",parseInt(tableRow.attr("isrequired"))),$("#requestTypeFieldEditorModal .requestTypeFieldAllowMultiple").prop("checked",parseInt(tableRow.attr("allowmultiple"))),$("#requestTypeFieldEditorModal .requestTypeFieldIsDisabled").prop("checked",parseInt(tableRow.attr("isdisabled"))),$("#requestTypeFieldEditorModal .requestTypeFieldRestrictAccess").prop("checked",parseInt(tableRow.attr("restrictaccess"))),$("#requestTypeFieldEditorModal .requestTypeFieldClearWhenDuplicate").prop("checked",parseInt(tableRow.attr("clearWhenDuplicate"))),dataTypeIdParsed==dataTypeEnums.UNIQUE_ID?($("#requestTypeFieldEditorModal .requestTypeFieldAllowMultiple").prop("disabled",!0),$("#requestTypeFieldEditorModal .requestTypeFieldClearWhenDuplicate").prop("checked",!0),$("#requestTypeFieldEditorModal .requestTypeFieldClearWhenDuplicate").prop("disabled",!0)):[dataTypeEnums.STRUCTURE,dataTypeEnums.RICH_TEXT,dataTypeEnums.BIOSPIN_EDITOR].includes(dataTypeIdParsed)?$("#requestTypeFieldEditorModal .requestTypeFieldAllowMultiple").prop("disabled",!0):($("#requestTypeFieldEditorModal .requestTypeFieldClearWhenDuplicate").removeProp("disabled"),$("#requestTypeFieldEditorModal .requestTypeFieldAllowMultiple").removeProp("disabled")),populateRequestTypeFieldRestrictionsContainer(tableRow,dataTypeIdParsed),hideFieldRestrictAccess(),$(".requestTypeFieldNotificationsContainer").addClass("makeVisible"),$('.requestTypeFieldNotificationsContainer table.requestTypeFieldNotificationsTable input[type="checkbox"]').prop("checked",!1);var defaultValueJson=JSON.parse(tableRow.attr("defaultvaluejson"));if($.inArray(dataTypeIdParsed,[dataTypeEnums.TEXT,dataTypeEnums.LONG_TEXT,dataTypeEnums.INTEGER,dataTypeEnums.REAL_NUMBER])>-1){for(levelKey in defaultValueJson)if("company"!=levelKey)for(id in defaultValueJson[levelKey])$(`.tabContent[${levelKey}id=${id}]`).find("input.defaultValueInput").val(defaultValueJson[levelKey][id]);else $("#requestTypeFieldEditorModal").find("input.defaultValueInput.company").val(defaultValueJson[levelKey]);$(".dependencyEditor").css("display","none")}else if(dataTypeIdParsed==dataTypeEnums.DROP_DOWN){for(levelKey in defaultValueJson)if("company"!=levelKey)for(id in defaultValueJson[levelKey])$(`.tabContent[${levelKey}id=${id}]`).find(`select.defaultValueDropdown option[value=${parseInt(defaultValueJson[levelKey][id])}]`).prop("selected",!0);else $(`#requestTypeFieldEditorModal select.defaultValueDropdown.company option[value=${parseInt(defaultValueJson[levelKey])}]`).prop("selected",!0);$(".dependencyEditor").css("display","block"),prepopulateDependencies()}else $(".dependencyEditor").css("display","none");let fieldValuesList=JSON.parse(tableRow.attr("requesttypefieldcustomattributevalues"));fieldValuesList.length&&fieldValuesList.forEach((function(val,index){addFieldCustomAttributeToEditor(val,requestType.requestTypeCustomAttributeDefinitions)})),$("#requestTypeFieldEditorModal .requestTypeFieldGroupContainer").html($("<div>").append(fieldGroupsDropdown.clone()).html()),$("#requestTypeFieldEditorModal .requestTypeFieldGroupContainer").find('.fieldGroupDropdown option[value="'+(parseInt(tableRow.attr("fieldgroup"))-1)+'"]').prop("selected",!0)},hideFieldRestrictAccess=function(){var isChecked,displayText=$(".requestTypeFieldRestrictAccess").is(":checked")?"display:block":"display:none";$(".requestTypeFieldRestrictAccessSection").attr("style",displayText)},emptyDependencyTable=function(){$(".dropdownDependencyBody").empty()},changeTargetValues=function(rowNum,savedFieldId){var selectorString=".dropdownCheckboxes[rownum={rowNum}]".replace("{rowNum}",rowNum);$(selectorString).empty();var requestTypeId=$(".dropdownEditorContainer").attr("requesttypeid"),requestType,currField=window.pageModeRequestTypes.find(x=>x.id==requestTypeId).fields.find(x=>x.requestTypeFieldId==savedFieldId);savedFieldId=currField.savedFieldId;var savedField=window.savedFieldsArray.find(x=>x.id==savedFieldId);if(void 0===savedField)$(selectorString).append(makeCheckboxHolder(rowNum,null,"Target not found"));else{var options=savedField.options;$.each(options,(function(index,option){$(selectorString).append(makeCheckboxHolder(rowNum,option.dropdownOptionId,option.displayName))}))}},makeCheckboxHolder=function(rowNum,value,text){var checkboxHolder=$("<div></div>").addClass("checkboxHolder");return $("<input />",{type:"checkbox",id:"cb"+rowNum+"-"+value,value:value,disabled:null===value}).appendTo(checkboxHolder),$("<label />",{for:"cb"+rowNum+"-"+value,text:text}).appendTo(checkboxHolder),checkboxHolder},prepopulateDependencies=function(){var currentDependencies=$(window.requestTypeFieldEditorTableRow).attr("dropdownrelations");if(void 0===currentDependencies){var requestTypeFieldId=$(window.requestTypeFieldEditorTableRow).attr("requesttypefieldid"),requestTypeId=$(".dropdownEditorContainer").attr("requesttypeid"),requestType=window.pageModeRequestTypes.find(x=>x.id==requestTypeId);if(void 0!==requestType){var currField=requestType.fields.find(x=>x.requestTypeFieldId==requestTypeFieldId);if(void 0!==currField){var savedFieldId=currField.savedFieldId,thisRowDependencies=$(window.requestTypeFieldEditorTableRow).attr("dependencies");if(void 0!==thisRowDependencies){thisRowDependencies=thisRowDependencies.split(",");var fieldDependencyValues=requestType.fieldDependencyValues,dependenciesThatExist=thisRowDependencies.filter(x=>Object.keys(fieldDependencyValues).indexOf(x)>=0);$.each(dependenciesThatExist,(function(index,dependencyKey){var srcVals=Object.keys(fieldDependencyValues[dependencyKey][savedFieldId]);$.each(srcVals,(function(srcIndex,srcVal){addDependencyRow(),populateDependencyRow(srcVal,dependencyKey,fieldDependencyValues[dependencyKey][savedFieldId][srcVal])}))}))}}}}else loadCurrentDependencies(JSON.parse(currentDependencies))},loadCurrentDependencies=function(currentDependencies){$.each(currentDependencies,(function(depIndex,dependency){"requestTypes"==requestTypePageMode?(srcVal=dependency.dropDownOptionId,targetId=dependency.targetRequestTypeFieldId,targetVals=dependency.requestTypeFieldDropDownDependencyValues.map(x=>x.targetDropDownOptionId)):"requestItemTypes"==requestTypePageMode&&(srcVal=dependency.dropDownOptionId,targetId=dependency.targetRequestItemTypeFieldId,targetVals=dependency.requestItemTypeFieldDropDownDependencyValues.map(x=>x.targetDropDownOptionId)),addDependencyRow(),populateDependencyRow(srcVal,targetId,targetVals)}))},addDependencyRow=function(){var tableLength=$(".dropdownDependencyBody").children().length,rowNum=0;if(tableLength>0)var rowNum=parseInt($($(".dropdownDependencyBody").children()[tableLength-1]).attr("rownum"))+1;var tr=$("<tr></tr>").attr("rownum",rowNum),srcCol=makeSrcColDropdown(rowNum),targetCol=makeTargetDropdown(rowNum),targetVals=$("<div></div>").addClass("dropdownCheckboxes").attr("rowNum",rowNum),emptyCheckbox=$("<div></div>").addClass("checkboxHolder");$("<input />",{type:"checkbox",id:"cb"+rowNum,value:null}).attr("disabled",!0).appendTo(emptyCheckbox),$("<label />",{for:"cb"+rowNum,text:"Select a Target"}).appendTo(emptyCheckbox),targetVals.append(emptyCheckbox);var deleteButton=$("<button></button>").addClass("basicActionButton").addClass("deleteRowButton").attr("rownum",rowNum).text("Delete");tr.append($("<td></td>").append(srcCol)).append($("<td></td>").append(targetCol)).append($("<td></td>").append(targetVals)).append($("<td></td>").append(deleteButton)),$(".dropdownDependencyBody").append(tr)},populateDependencyRow=function(srcVal,targetVal,selectedTargets){var rowNum=$(".dropdownDependencyBody").children().length-1,srcDropdown=$(".srcValues[rownum="+rowNum+"]"),targetDropdown=$(".targetDropdowns[rownum="+rowNum+"]"),targetCheckboxes=$(".dropdownCheckboxes[rownum="+rowNum+"]");srcDropdown.val(srcVal),targetDropdown.val(targetVal),targetDropdown.change(),$.each(selectedTargets,(function(index,target){var selectorString;$("#cb"+rowNum+"-"+target).attr("checked",!0)}))},getDropdownRelationFromTable=function(){var returnObj=[],requestTypeFieldId=$(window.requestTypeFieldEditorTableRow).attr("requesttypefieldid"),requestTypeId=$(".dropdownEditorContainer").attr("requesttypeid"),requestType=window.pageModeRequestTypes.find(x=>x.id==requestTypeId),currField;if(null!=requestType)var currField=requestType.fields.find(x=>x.requestTypeFieldId==requestTypeFieldId);if(void 0===requestType)return"No relation";if(void 0!==(currField=requestType.fields.find(x=>x.requestTypeFieldId==requestTypeFieldId))){var savedFieldId=currField.savedFieldId,srcFieldName="requestTypeFieldId",targetFieldName="targetRequestTypeFieldId",targetFieldDependencyKey="requestTypeFieldDropDownDependencyValues";return"requestItemTypes"==requestTypePageMode&&(srcFieldName="requestItemTypeFieldId",targetFieldName="targetRequestItemTypeFieldId",targetFieldDependencyKey="requestItemTypeFieldDropDownDependencyValues"),$.each($(".dropdownDependencyBody").children(),(function(index,row){var rowObj={},srcId=parseInt(currField.requestTypeFieldId),srcVal=parseInt($(".srcValues[rownum="+index+"]").find(":selected").val()),targVal=parseInt($(".targetDropdowns[rownum="+index+"]").find(":selected").val()),targChecks=$(".dropdownCheckboxes[rownum="+index+"] > .checkboxHolder > input:checked").map((function(){return{targetDropDownOptionId:parseInt(this.value)}})).get();if(0!=targChecks.length){var existingRow=returnObj.find(x=>x[srcFieldName]==srcId&&x.dropDownOptionId==srcVal&&x[targetFieldName]==targVal);void 0===existingRow?(rowObj[srcFieldName]=srcId,rowObj.dropDownOptionId=srcVal,rowObj[targetFieldName]=targVal,rowObj[targetFieldDependencyKey]=targChecks,returnObj.push(rowObj)):existingRow[targetFieldDependencyKey]=existingRow[targetFieldDependencyKey].concat(targChecks)}})),returnObj}},makeSrcColDropdown=function(rowNum){var srcCol=$("<select></select>").addClass("srcValues").attr("rowNum",rowNum);srcCol.append($("<option></option>").text("-- Make a Selection --").val(null));var requestTypeFieldId=$(window.requestTypeFieldEditorTableRow).attr("requesttypefieldid"),requestTypeId=$(".dropdownEditorContainer").attr("requesttypeid"),requestType=window.pageModeRequestTypes.find(x=>x.id==requestTypeId);if(void 0===requestType)return srcCol;var currField=requestType.fields.find(x=>x.requestTypeFieldId==requestTypeFieldId);if(void 0===currField)return srcCol;var savedFieldId=currField.savedFieldId,savedField=window.savedFieldsArray.find(x=>x.id==savedFieldId);if(void 0===savedField)return srcCol;var options=savedField.options;return $.each(options,(function(index,option){$("<option></option>").text(option.displayName).val(option.dropdownOptionId).appendTo(srcCol)})),srcCol},makeTargetDropdown=function(rowNum){var targCol=$("<select></select>").addClass("targetDropdowns").attr("rowNum",rowNum);targCol.append($("<option></option>").text("-- Make a Selection --").val(null));var requestTypeFieldId=$(window.requestTypeFieldEditorTableRow).attr("requesttypefieldid"),requestTypeId=$(".dropdownEditorContainer").attr("requesttypeid"),requestType=window.pageModeRequestTypes.find(x=>x.id==requestTypeId);if(void 0===requestType)return targCol;var currField=requestType.fields.find(x=>x.requestTypeFieldId==requestTypeFieldId);if(void 0===currField)return targCol;var currFields=requestType.fieldsDict;return $.each(currFields.sortOrder,(function(index,key){var field=currFields[key][0];field.requestTypeFieldId!=currField.requestTypeFieldId&&5==field.dataTypeId&&$("<option></option>").text(field.displayName).val(field.requestTypeFieldId).appendTo(targCol)})),targCol},getExistingDropdownRelation=function(requestType,savedFieldId){var returnObj={},fieldDependencies=requestType.fieldDependencies,fieldDependencyValues=requestType.fieldDependencyValues,targetIds=fieldDependencies[savedFieldId];return void 0!==fieldDependencyValues&&$.each(targetIds,(function(targIdIndex,targetId){if(!(Object.keys(fieldDependencyValues).indexOf(targetId.toString())<0)){var srcToTargetValJSON=fieldDependencyValues[targetId][savedFieldId];if(void 0!==srcToTargetValJSON){var srcVals=Object.keys(srcToTargetValJSON);$.each(srcVals,(function(srcValIndex,srcVal){var targVals=srcToTargetValJSON[srcVal];Object.keys(returnObj).indexOf(srcVal)<0&&(returnObj[srcVal]={}),returnObj[srcVal][targetId]=targVals}))}}})),returnObj},updateGlobalFieldGroupsDropdown=function(numberOfGroups){fieldGroupsDropdown=$('<select class="fieldGroupDropdown editorFieldDropdown">').html('<option value=""></option>');for(var i=0;i<numberOfGroups+1;i++)fieldGroupsDropdown.append($("<option>").attr("value",i).text(fieldGroups[i]))},getDefaultSelectValue=function(){return $("input[name=defaultSelect]:checked").val()},populateRequestTypeFieldRestrictionsContainer=function(requestTypeFieldRowElement,datatypeid){$(".requestTypeFieldRestrictionsContainer").addClass("makeVisible"),chosenFieldName=requestTypeFieldRowElement.find("select.savedFieldDropdown option:selected").text(),$('.requestTypeFieldRestrictionsContainer table.restrictAccessTable input[type="checkbox"]').prop("checked",!1);var groupRows=$(".dropdownEditorContainer #requestTypeFieldAllowedGroupsTable tbody > div > div > tr"),userRows=$(".dropdownEditorContainer #requestTypeFieldAllowedUsersTable tbody > div > div > tr");datatypeid==dataTypeEnums.UNIQUE_ID?($.each(groupRows,(function(index,row){$(row).find('input[type="checkbox"].canAddCheckbox').prop("disabled",!0),$(row).find('input[type="checkbox"].canEditCheckbox').prop("disabled",!0),$(row).find('input[type="checkbox"].canDeleteCheckbox').prop("disabled",!0)})),$.each(userRows,(function(index,row){$(row).find('input[type="checkbox"].canAddCheckbox').prop("disabled",!0),$(row).find('input[type="checkbox"].canEditCheckbox').prop("disabled",!0),$(row).find('input[type="checkbox"].canDeleteCheckbox').prop("disabled",!0)}))):($.each(groupRows,(function(index,row){$(row).find('input[type="checkbox"].canAddCheckbox').removeProp("disabled"),$(row).find('input[type="checkbox"].canEditCheckbox').removeProp("disabled"),$(row).find('input[type="checkbox"].canDeleteCheckbox').removeProp("disabled")})),$.each(userRows,(function(index,row){$(row).find('input[type="checkbox"].canAddCheckbox').removeProp("disabled"),$(row).find('input[type="checkbox"].canEditCheckbox').removeProp("disabled"),$(row).find('input[type="checkbox"].canDeleteCheckbox').removeProp("disabled")}))),requestTypeFieldRowElement.attr("restrictaccesssettings")&&(restrictAccessSettings=JSON.parse(requestTypeFieldRowElement.attr("restrictaccesssettings")),console.log(restrictAccessSettings),populateRestrictAccessSettingsTables("requestTypeField",restrictAccessSettings.users,restrictAccessSettings.groups)),$(".requestTypeFieldRestrictionsContainer .restrictionsContainerTitle .restrictionsContainerTitleFieldName").text(chosenFieldName)},updateRequestTypeFieldNotificationSettingsContainerAttribute=function(){return notificationSettingsObject={},$("#requestTypeFieldNotificationsEditorSection").attr("notificationsettings")&&(notificationSettingsObject=JSON.parse($("#requestTypeFieldNotificationsEditorSection").attr("notificationsettings"))),groupsArray=[],$.each($(".requestTypeFieldNotificationsContainer").find("table#requestTypeFieldNotificationsTable tbody tr"),(function(){group={groupId:parseInt($(this).attr("groupid")),notifyByEmail:$(this).find(".notifyByEmailCheckbox").prop("checked"),notifyByBrowser:$(this).find(".notifyByBrowserCheckbox").prop("checked")},groupsArray.push(group)})),"requestTypes"==window.requestTypePageMode?notificationSettingsObject.groups=groupsArray:notificationSettingsObject[$("#requestTypesDropdownForNotificationSettings").val()]={groups:groupsArray},notificationSettingsObject},updateNameDropDown=function(){var requestFieldRows=$("#requestTypeFieldsTable > tbody > tr"),reqFieldSelect=$("#requestNameSelectField");reqFieldSelect.empty(),$(reqFieldSelect).append($("<option value='0'>--Not Used--</option>"));var restrictedDataTypes=[2,6,8,9];$.each(requestFieldRows,(function(){var fieldId=$(this).attr("savedfieldid"),requestFieldId=$(this).attr("requesttypefieldid"),newOption=$("<option></option>"),fieldInRequest=savedFieldsArray.find(x=>x.id==fieldId);void 0!==fieldInRequest&&restrictedDataTypes.indexOf(fieldInRequest.dataTypeId)<0&&($(newOption).attr("savedfieldid",fieldId),$(newOption).attr("value",requestFieldId),$(newOption).html(fieldInRequest.displayName),reqFieldSelect.append(newOption))})),null!=typeof reqFieldSelect.attr("savedItem")&&($("#requestNameSelectField").find('option[selected="selected"]').prop("selected",!1),$("#requestNameSelectField").find('option[value="'+reqFieldSelect.attr("savedItem")+'"]').prop("selected",!0))},getCodes=function(){var codeParams={appName:"Workflow",setName:"reqNameIncrementingNumType"};ajaxModule().getCodes(codeParams).then((function(response){response=utilities().decodeServiceResponce(response);var dd=$("#selectIncromentingNum");$(dd).append($("<option value='0'>--Not Used--</option>")),$.each(response,(function(){var Option=$("<option></option>");$(Option).attr("value",this.codeValue),$(Option).html(this.codeDescription),$(dd).append(Option)}))}))},populateUsersAndUserGroupsAllowedTables=function(selectorStringFragmentArray){$.each(selectorStringFragmentArray,(function(index,selectorStringFragment){var allowedUsersTableRows=generateAllowedUsersTableRows(),allowedGroupsTableRows=generateAllowedGroupsTableRows();populateAllowedUsersTabs(),populateAllowedGroupsTabs(),$(".dropdownEditorContainer #"+selectorStringFragment+"AllowedUsersTable > tbody").append(allowedUsersTableRows),$(".dropdownEditorContainer #"+selectorStringFragment+"AllowedGroupsTable > tbody").append(allowedGroupsTableRows),$(".dropdownEditorContainer #"+selectorStringFragment+"AllowedUsersTable > tbody, .dropdownEditorContainer #"+selectorStringFragment+"AllowedGroupsTable > tbody").mCustomScrollbar({theme:"light-3",scrollButtons:{enable:!1},mouseWheel:{preventDefault:!0},scrollbarPosition:"inside",autoExpandScrollbar:!0,theme:"dark",axis:"y",setWidth:"auto"})}))},populateRestrictAccessSettingsTables=function(selectorStringFragment,allowedUsers,allowedGroups){console.log(selectorStringFragment),console.log(allowedUsers),console.log(allowedGroups),null==allowedUsers&&(allowedUsers=[]),null==allowedGroups&&(allowedGroups=[]),"requestType"==selectorStringFragment?($.each(allowedUsers,(function(allowedUserIndex,allowedUser){$(".CanAddCheckbox[userId="+allowedUser.userId+"]").prop("checked",allowedUser.canAdd),$(".CanViewCheckbox[userId="+allowedUser.userId+"]").prop("checked",allowedUser.canView),$(".CanEditCheckbox[userId="+allowedUser.userId+"]").prop("checked",allowedUser.canEdit),$(".CanDeleteCheckbox[userId="+allowedUser.userId+"]").prop("checked",allowedUser.canDelete),$(".CanBeAssignedCheckbox[userId="+allowedUser.userId+"]").prop("checked",allowedUser.canBeAssigned)})),$.each(allowedGroups,(function(allowedGroupIndex,allowedGroup){$(".CanAddCheckbox[groupId="+allowedGroup.groupId+"]").prop("checked",allowedGroup.canAdd),$(".CanViewCheckbox[groupId="+allowedGroup.groupId+"]").prop("checked",allowedGroup.canView),$(".CanEditCheckbox[groupId="+allowedGroup.groupId+"]").prop("checked",allowedGroup.canEdit),$(".CanDeleteCheckbox[groupId="+allowedGroup.groupId+"]").prop("checked",allowedGroup.canDelete),$(".CanBeAssignedCheckbox[groupId="+allowedGroup.groupId+"]").prop("checked",allowedGroup.canBeAssigned)}))):($.each(allowedGroups,(function(allowedGroupIndex,allowedGroup){var thisTR=$(".dropdownEditorContainer #"+selectorStringFragment+'AllowedGroupsTable tbody tr[groupid="'+allowedGroup.groupId+'"]');thisTR.length>0&&(thisTR.find('input[type="checkbox"].canAddCheckbox').prop("checked",allowedGroup.canAdd),thisTR.find('input[type="checkbox"].canViewCheckbox').prop("checked",allowedGroup.canView),thisTR.find('input[type="checkbox"].canEditCheckbox').prop("checked",allowedGroup.canEdit),thisTR.find('input[type="checkbox"].canDeleteCheckbox').prop("checked",allowedGroup.canDelete),thisTR.find('input[type="checkbox"].canBeAssignedCheckbox').prop("checked",allowedGroup.canBeAssigned))})),$.each(allowedUsers,(function(allowedUserIndex,allowedUser){var thisTR=$(".dropdownEditorContainer #"+selectorStringFragment+'AllowedUsersTable tbody tr[userid="'+allowedUser.userId+'"]');thisTR.length>0&&(thisTR.find('input[type="checkbox"].canAddCheckbox').prop("checked",allowedUser.canAdd),thisTR.find('input[type="checkbox"].canViewCheckbox').prop("checked",allowedUser.canView),thisTR.find('input[type="checkbox"].canEditCheckbox').prop("checked",allowedUser.canEdit),thisTR.find('input[type="checkbox"].canDeleteCheckbox').prop("checked",allowedUser.canDelete),thisTR.find('input[type="checkbox"].canBeAssignedCheckbox').prop("checked",allowedUser.canBeAssigned))})))},generateAllowedUsersTableRows=function(){var userTableRowsArray=[];return $.each(window.usersList,(function(userIndex,thisUser){var tableRow=$("<tr></tr>").attr("userid",thisUser.id).attr("userindex",userIndex);tableRow.append($("<td></td>").append($("<div>").text(thisUser.fullName).addClass("userFullNameContainer"))),tableRow.append($("<td>").append('<input type="checkbox" class="canAddCheckbox">'),$("<td>").append('<input type="checkbox" class="canViewCheckbox">'),$("<td>").append('<input type="checkbox" class="canEditCheckbox">'),$("<td>").append('<input type="checkbox" class="canDeleteCheckbox">'),$('<td class="canBeAssignedCheckboxTD">').append('<input type="checkbox" class="canBeAssignedCheckbox">')),userTableRowsArray.push(tableRow)})),userTableRowsArray},generateAllowedGroupsTableRows=function(){var groupTableRowsArray=[];return $.each(window.groupsList,(function(groupIndex,thisGroup){var tableRow=$("<tr></tr>").attr("groupid",thisGroup.id).attr("groupindex",groupIndex);tableRow.append($("<td></td>").append($("<div>").text(thisGroup.name).addClass("groupNameContainer"))),tableRow.append($("<td>").append('<input type="checkbox" class="canAddCheckbox">'),$("<td>").append('<input type="checkbox" class="canViewCheckbox">'),$("<td>").append('<input type="checkbox" class="canEditCheckbox">'),$("<td>").append('<input type="checkbox" class="canDeleteCheckbox">'),$('<td class="canBeAssignedCheckboxTD">').append('<input type="checkbox" class="canBeAssignedCheckbox">')),groupTableRowsArray.push(tableRow)})),groupTableRowsArray},populateAllowedUsersTabs=function(){var section="allowedUser";emptyTabs(section);var sortedUsersList=utilities().sortArray(window.usersList,"fullName");generateAllowedUsersTabs(section,sortedUsersList)},emptyTabs=function(section){$(`.editRequestTabs > .${section}s`).empty(),$(`.editRequestTabs > .${section}sTabs`).empty()},generateAllowedUsersTabs=function(section,sortedUsersList){$.each(sortedUsersList,(function(userIndex,thisUser){var tabLabel=generateTabLabel(section,thisUser.fullName,"userId",thisUser.id),tabContent=generateTabContent(section,thisUser.fullName,"userId",thisUser.id);tabContent.append(generateSettingsTab("Can Add",thisUser.fullName,thisUser.id,"userId")),tabContent.append(generateSettingsTab("Can View",thisUser.fullName,thisUser.id,"userId")),tabContent.append(generateSettingsTab("Can Edit",thisUser.fullName,thisUser.id,"userId")),tabContent.append(generateSettingsTab("Can Delete",thisUser.fullName,thisUser.id,"userId")),tabContent.append(generateSettingsTab("Can Be Assigned",thisUser.fullName,thisUser.id,"userId").css("display","none")),$(`.editRequestTabs > .${section}s`).append(tabLabel),$(`.editRequestTabs > .${section}sTabs`).append(tabContent)}))},populateAllowedGroupsTabs=function(){var section="allowedGroup";emptyTabs(section);var sortedGroupsList=utilities().sortArray(window.groupsList,"name");generateAllowedGroupsTabs(section,sortedGroupsList)},generateAllowedGroupsTabs=function(section,sortedGroupsList){$.each(sortedGroupsList,(function(groupIndex,thisGroup){var tabLabel=generateTabLabel(section,thisGroup.name,"groupId",thisGroup.id),tabContent=generateTabContent(section,thisGroup.name,"groupId",thisGroup.id);tabContent.append(generateSettingsTab("Can Add",thisGroup.name,thisGroup.id,"groupId")),tabContent.append(generateSettingsTab("Can View",thisGroup.name,thisGroup.id,"groupId")),tabContent.append(generateSettingsTab("Can Edit",thisGroup.name,thisGroup.id,"groupId")),tabContent.append(generateSettingsTab("Can Delete",thisGroup.name,thisGroup.id,"groupId")),tabContent.append(generateSettingsTab("Can Be Assigned",thisGroup.name,thisGroup.id,"groupId")),$(`.editRequestTabs > .${section}s`).append(tabLabel),$(`.editRequestTabs > .${section}sTabs`).append(tabContent)}))},generateTabLabel=function(section,name,idAttr,id){return $("<button></button>").addClass("tablinks").addClass(`${section}s${name.replace(/ /g,"_")}`).attr(idAttr,id).text(name).click((function(){openTab(section,name.replace(/ /g,"_"),idAttr,id)}))},generateTabContent=function(section,name,idAttr,id){return $("<div></div>").addClass("tabContent").addClass(`${section}Tab${name.replace(/ /g,"_")}`).attr(idAttr,id)},populateUserDefaultsTabs=function(){var section="userDefault";emptyTabs(section);var sortedUsersList=utilities().sortArray(window.usersList,"fullName");generateUserDefaultsTabs(section,sortedUsersList)},populateGroupDefaultsTabs=function(){var section="groupDefault";emptyTabs(section);var sortedUsersList=utilities().sortArray(window.groupsList,"name");generateGroupDefaultsTabs(section,sortedUsersList)},generateUserDefaultsTabs=function(section,sortedUsersList){$.each(sortedUsersList,(function(userIndex,thisUser){var tabLabel=generateTabLabel(section,thisUser.fullName,"userId",thisUser.id),tabContent=generateTabContent(section,thisUser.fullName,"userId",thisUser.id);tabContent.append(generateDefaultValueEditor()),$(`.editRequestTabs > .${section}s`).append(tabLabel),$(`.editRequestTabs > .${section}sTabs`).append(tabContent)}))},generateGroupDefaultsTabs=function(section,sortedGroupsList){$.each(sortedGroupsList,(function(index,thisGroup){var tabLabel=generateTabLabel(section,thisGroup.name,"groupId",thisGroup.id),tabContent=generateTabContent(section,thisGroup.name,"groupId",thisGroup.id);tabContent.append(generateDefaultValueEditor()),$(`.editRequestTabs > .${section}s`).append(tabLabel),$(`.editRequestTabs > .${section}sTabs`).append(tabContent)}))},openTab=function(section,tabName,idAttr,id){$(`.${section}s > .tablinks`).removeClass("active"),$(`.${section}s${tabName.replace(new RegExp("/","g"),"\\/")}[${idAttr}=${id}]`).addClass("active"),$(`.${section}sTabs > .tabContent`).css("display","none"),$(`.${section}sTabs > .tabContent.${section}tab${tabName.replace(new RegExp("/","g"),"\\/")}[${idAttr}=${id}]`).css("display","block")},generateSettingsTab=function(settingName,groupName,groupId,idAttr){var settingNameNoSpace=settingName.replace(/ /g,""),className=settingNameNoSpace+"Checkbox",idName=groupName+settingNameNoSpace,label=groupName+settingNameNoSpace,checkboxHolder=$("<div></div>").addClass("tabLabel"),checkboxDiv=$('<input type="checkbox" class="'+className+'" id="'+idName+'">').attr(idAttr,groupId),checkBoxLabel=$("<label for='"+label+"'>").text(settingName);return checkboxHolder.append(checkboxDiv,checkBoxLabel),checkboxHolder},generateDefaultValueEditor=function(){var containerDiv=$("<div>").addClass("editorField").attr("fieldid","requestTypeFieldDefaultValue"),label=$("<label>").addClass("editorFieldLabel").text("Default Value"),textInput=$("<input>").addClass("defaultValueInput").attr("type","text"),dropdownInput=$("<select>").addClass("defaultValueDropdown defaultEditorDropdown");return containerDiv.append(label).append(textInput).append(dropdownInput)},documentReadyFunction=async function(){if(populateUsersAndUserGroupsAllowedTables(["requestType","requestTypeField"]),getCodes(),$("body").on("click",".newDropdownButton",(function(event){showRequestTypeEditor()})),$("body").on("click",".addSavedFieldButton",(function(event){addRequestTypeFieldToEditor()})),$("body").on("click","#requestTypeRequestItemTypesEditorSection .addRequestItemTypeButton",(function(event){addRequestItemTypeToEditor()})),$("body").on("click",".addCustomAttribute",(function(event){addCustomAttributeToEditor()})),$("body").on("click",".addFieldCustomAttribute",(function(event){addFieldCustomAttributeToEditor()})),$("body").on("click","table#requestTypeCustomAttributesTable > tbody > tr > td > .editorSectionTableRowDeleteButton",(function(event){let tableId=$(this).parent().parent().parent().parent().attr("id");$(this).parent().parent().remove(),updateAttrDropdowns(tableId)})),$("body").on("click","table#requestTypeFieldCustomAttributesTable > tbody > tr > td > .editorSectionTableRowDeleteButton",(function(event){let tableId=$(this).parent().parent().parent().parent().attr("id");$(this).parent().parent().remove(),updateAttrDropdowns(tableId)})),$("body").on("click",".autoGenCheck",(function(e){1==$(this).prop("checked")&&$("[fieldid = requestTypeFieldBiDirectinalLink]").find("input").prop("checked",!0)})),$("body").on("click",".dropdownEditorSubmit",(async function(event){let response;response="requestTypes"==requestTypePageMode?await submitRequestTypeEditor():await submitRequestItemTypeEditor();var requestTypeId=""!==editor.attr("requesttypeid")?parseInt(editor.attr("requesttypeid")):0,requestTypeName=editor.find('[fieldid="displayName"] input[type="text"]').val(),reqTypeOrReqItemTypeNotificationText="request type";let notificationTitle;"requestItemTypes"==window.requestTypePageMode&&(reqTypeOrReqItemTypeNotificationText="request item type"),Object.keys(response).indexOf("error")>=0?(console.log("error"),notificationTitle=requestTypeId?"Failed to update "+reqTypeOrReqItemTypeNotificationText+' "'+requestTypeName+'".':'Failed to create new "'+reqTypeOrReqItemTypeNotificationText+' "'+requestTypeName+'".',window.upsertRequestTypeNotification.update({title:notificationTitle,message:response.error,type:"danger"})):(console.log("success"),notificationTitle=requestTypeId?"Successfully updated "+reqTypeOrReqItemTypeNotificationText+' "'+requestTypeName+'".':"Successfully created new "+reqTypeOrReqItemTypeNotificationText+' "'+requestTypeName+'".',window.upsertRequestTypeNotification.update({title:notificationTitle,message:"",type:"success"}),swal({title:"Successfully updated",type:"success",confirmButtonText:"Ok",timer:1100}),hideRequestTypeEditor(),location.reload())})),$("body").on("click",".dropdownEditorCancel",(function(event){hideRequestTypeEditor()})),$("body").on("click","table#dropdownsTable tr td",(function(event){var requestTypeId=$("#dropdownsTable").DataTable().row($(this).parent()).data()[7];showRequestTypeEditor(requestTypeId)})),$("body").on("click","table#requestTypeFieldsTable > tbody > tr > td > .editorSectionTableRowDeleteButton",(function(event){$(this).parent().parent().remove()})),$("body").on("click","table#requestTypeRequestItemTypesTable > tbody > tr > td > .editorSectionTableRowDeleteButton",(function(event){$(this).parent().parent().remove()})),$("body").on("change","select#dataTypeDropdown",(function(event){"5"==$(this).val()?($("#dropdownOptionsEditorSection").addClass("makeVisible"),$("#dropdownOptionsEditorSection #dropdownOptionsTable > tbody").empty()):$("#dropdownOptionsEditorSection").removeClass("makeVisible")})),$("body").on("change","select#savedDropdownsListDropdown",(function(event){if($("#dropdownOptionsTable > tbody").empty(),""!==$(this).val()){var selectedDropdownObject=window.dropdownsArray[parseInt($(this).val())];void 0!==selectedDropdownObject.options&&$.each(selectedDropdownObject.options,(function(index,option){addRequestTypeFieldToEditor(option,!0,!0)})),$("#dropdownOptionsEditorSection").hasClass("savedDropdownIsSynced")&&($("#dropdownOptionsEditorSection button.newDropdownOptionButton").prop("disabled",!0),$("#dropdownOptionsEditorSection #dropdownOptionsTable").find("input, button").prop("disabled",!0))}})),$("body").on("change","#savedDropdownsListSyncCheckbox",(function(event){var isChecked;$(this).prop("checked")?($("select#savedDropdownsListDropdown").change(),$("#dropdownOptionsEditorSection").addClass("savedDropdownIsSynced"),$("#dropdownOptionsEditorSection button.newDropdownOptionButton").prop("disabled",!0),$("#dropdownOptionsEditorSection #dropdownOptionsTable").find("input, button").prop("disabled",!0)):($("#dropdownOptionsEditorSection").removeClass("savedDropdownIsSynced"),$("#dropdownOptionsEditorSection button.newDropdownOptionButton").prop("disabled",!1),$("#dropdownOptionsEditorSection #dropdownOptionsTable").find("input, button").prop("disabled",!1))})),$("body").on("change",".requestType_requestItemTypeDropdown",(function(event){var thisRequestItemTypeName=$(this).find("option:selected").text();$(this).parent().parent().find('input[type="text"].requestType_requestItemCustomName').val(thisRequestItemTypeName)})),$("body").on("change",".dropdownEditorContainer #dataTypeDropdown",(function(event){dataTypeId=$(this).val(),$(".dropdownEditorContainer").attr("datatypeid",dataTypeId)})),$("body").on("change",'.dropdownEditorContainer .editorField[fieldid="restrictAccess"] input[type="checkbox"]',(function(event){var isChecked;$(this).prop("checked")?($(".editorSection.requestTypeRestrictAccessSection").addClass("makeVisible"),"requestTypes"==requestTypePageMode?$("#requestTypeAllowedAppsEditorSection").show():$("#requestTypeAllowedAppsEditorSection").hide()):$(".editorSection.requestTypeRestrictAccessSection").removeClass("makeVisible")})),$("body").on("click",".requestTypeFieldRestrictionsContainer .cancelChangesButton",(function(event){$(this).closest(".requestTypeFieldRestrictionsContainer").removeClass("makeVisible")})),$("body").on("click",".requestTypeFieldRestrictionsContainer .submitUpdateButton",(function(event){var requestTypeFieldRestrictionsContainer=$(this).closest(".requestTypeFieldRestrictionsContainer");allowedUsersArray=[],$.each(requestTypeFieldRestrictionsContainer.find("table#requestTypeFieldAllowedUsersTable tbody tr"),(function(){allowedUser={userId:parseInt($(this).attr("userid")),canAdd:$(this).find(".canAddCheckbox").prop("checked"),canView:$(this).find(".canViewCheckbox").prop("checked"),canEdit:$(this).find(".canEditCheckbox").prop("checked"),canDelete:$(this).find(".canDeleteCheckbox").prop("checked")},allowedUsersArray.push(allowedUser)})),allowedGroupsArray=[],$.each(requestTypeFieldRestrictionsContainer.find("table#requestTypeFieldAllowedGroupsTable tbody tr"),(function(){allowedGroup={groupId:parseInt($(this).attr("groupid")),canAdd:$(this).find(".canAddCheckbox").prop("checked"),canView:$(this).find(".canViewCheckbox").prop("checked"),canEdit:$(this).find(".canEditCheckbox").prop("checked"),canDelete:$(this).find(".canDeleteCheckbox").prop("checked")},allowedGroupsArray.push(allowedGroup)})),restrictAccessSettings={users:allowedUsersArray,groups:allowedGroupsArray},requestTypeFieldRestrictionsContainer.removeClass("makeVisible")})),$("body").on("click","button.manageFieldNotificationsButton",(function(event){thisRequestTypeFieldRowElement=$(this).closest("tr");var notificationSettings=thisRequestTypeFieldRowElement.attr("notificationsettings");$("#requestTypeFieldNotificationsEditorSection").attr("notificationsettings",notificationSettings),window.currentNotificationSettingsRow=thisRequestTypeFieldRowElement})),$("body").on("click",".requestTypeFieldNotificationsContainer .submitUpdateButton",(function(event){notificationSettingsObject=updateRequestTypeFieldNotificationSettingsContainerAttribute(),window.currentNotificationSettingsRow.attr("notificationsettings",JSON.stringify(notificationSettingsObject)).removeClass("activeRow"),$(".requestTypeFieldNotificationsContainer").removeClass("makeVisible")})),$("body").on("click",".requestTypeFieldNotificationsContainer .cancelChangesButton",(function(event){$(this).closest(".requestTypeFieldNotificationsContainer").removeClass("makeVisible"),window.currentNotificationSettingsRow.removeClass("activeRow")})),$("body").on("change","select#requestTypesDropdownForNotificationSettings",(function(event){})),$("body").on("change","table#requestTypeFieldsTable select.savedFieldDropdown",(function(event){$(this).find('option[selected="selected"]').prop("selected",!1),$(this).find("option:selected").prop("selected",!0),updateRequestTypeFieldSavedFieldChoice($(this).closest("tr"))})),$("#requestTypeAllowedAppsSelect").on("change",(async function(){let appId=$(this).val();await updateCustAttrDefs(appId)})),await Promise.all(dtPromise),await populateDataTypes(),await ajaxModule().populateSavedFieldsList(),populateRequestTypesTable(),$("#requestTypeFieldsTable > tbody").sortable({placeholder:"ui-state-highlight",helper:"clone"}),"requestTypes"==window.requestTypePageMode?ajaxModule().populateRequestItemTypesList():$($("#requestTypeFieldsTable > thead > tr > th")[4]).addClass("hide"),$("body").on("change","select.fieldGroupDropdown",(function(event){var greatestFieldGroupNumber=0;$("#requestTypeFieldsTable select.fieldGroupDropdown").each((function(){if(""!==$(this).val()){var thisFieldGroupNumber=parseInt($(this).val())+1;console.log(thisFieldGroupNumber),thisFieldGroupNumber>greatestFieldGroupNumber&&(greatestFieldGroupNumber=thisFieldGroupNumber)}})),console.log(greatestFieldGroupNumber),updateGlobalFieldGroupsDropdown(greatestFieldGroupNumber),$("#requestTypeFieldsTable select.fieldGroupDropdown").each((function(){var currentDropdownValue=$(this).val();$(this).html(fieldGroupsDropdown.html()),$(this).find('option[value="'+currentDropdownValue+'"]').prop("selected",!0)}));var newFieldGroupValue="";isNaN(parseInt($(this).val()))||(newFieldGroupValue=parseInt($(this).val())+1),$(this).closest("tr").attr("fieldgroup",newFieldGroupValue)})),$("body").on("click","button.manageRequestItemTypeNotificationSettingsButton",(function(event){thisRequestItemTypeRowElement=$(this).closest("tr");var notificationSettings=thisRequestItemTypeRowElement.attr("notificationsettings");$("#requestItemReprioritizationNotificationsEditorSection").attr("notificationsettings",notificationSettings),window.currentRequestItemReprioritizationNotificationSettingsRow=thisRequestItemTypeRowElement,populateRequestItemReprioritizationNotificationsContainer(thisRequestItemTypeRowElement),$("#reprioritizationRequestItemTypeNotificationSettingsModal").modal("show")})),$("body").on("click","#reprioritizationRequestItemTypeNotificationSettingsModal .submitUpdateButton",(function(event){notificationSettingsObject=updateRequestItemNotificationSettingsContainerAttribute(),window.currentRequestItemReprioritizationNotificationSettingsRow.attr("notificationsettings",JSON.stringify(notificationSettingsObject.groups)).removeClass("activeRow"),$("#reprioritizationRequestItemTypeNotificationSettingsModal").modal("hide")})),$("body").on("click","#reprioritizationRequestItemTypeNotificationSettingsModal .cancelChangesButton",(function(event){$("#reprioritizationRequestItemTypeNotificationSettingsModal").modal("hide")})),$("body").on("click",".manageFieldOptionsButton",(function(event){$("#requestTypeFieldEditorModal .modal-content").html(populateRequestTypeFieldEditor($(this).closest("tr"))),$("#requestTypeFieldEditorModal").modal("show")})),$("body").on("click",".requestTypeFieldEditorCancel",(function(event){$("#requestTypeFieldEditorModal").modal("hide")})),$("body").on("click",".requestTypeFieldEditorSubmit",(function(event){var success;submitRequestTypeFieldEditor()&&$("#requestTypeFieldEditorModal").modal("hide")})),$("input[name=defaultSelect]").change((function(){if($("input[name=defaultSelect]").attr("disabled","None"!=this.value),"None"==this.value||"Company"==this.value)$("#defaultDropdownOptions").attr("disabled",!0),$("#defaultDropdownOptions").hide();else{var list;$("#defaultDropdownOptions").empty(),$("#defaultDropdownOptions").append('<option value="None" selected emptyDefaultOption>-- Make a Selection --</option>'),$("#defaultDropdownOptions").attr("disabled",!1),$("#defaultDropdownOptions").show();var name="";if("Group"==this.value)list=groupsList,name="name";else{if("User"!=this.value)return!1;list=usersList,name="fullName"}$.each(list,(function(index,value){var option=$("<option></option>").attr("value",value.id).text(value[name]);$("#defaultDropdownOptions").append(option)}))}})),$("body").on("click",".addDependencyButton",(function(){addDependencyRow()})),$("body").on("change",".targetDropdowns",(function(){changeTargetValues($(this).attr("rowNum"),$(this).val())})),$("body").on("click",".deleteRowButton",(function(){var rowNum=$(this).attr("rownum"),selectorString=".dropdownDependencyBody > tr[rownum={rowNum}]".replace("{rowNum}",rowNum);$(selectorString).remove()})),$("body").on("click","#configRequestNameAccord",(function(){updateNameDropDown()})),$("body").on("click","#useField",(function(){updateNameDropDown()})),$("body").on("change","#requestNameSelectField",(function(){$(this).attr("savedItem",$(this).val()),updateNameDropDown()})),$("body").on("click","#requestNamesCheck",(function(){updateNameDropDown()})),$("body").on("click","#configRequestNotifications",(function(){openNotificationEditor($(this).attr("requesttypeId"))})),$(".requestTypeFieldRestrictAccess").on("click",(function(){hideFieldRestrictAccess()})),$("body").on("click",".filterValueCheckbox[existing='true']",(function(event){0==window.top.isSupport&&swal("Please contact support@arxspan.com!","This action may lead to data loss.","warning")})),$("body").on("click",".filterValueCheckbox:checked",(function(event){window.top.isSupport?updatePriorityTable($(event.target).closest("table"),$(event.target).closest("tr")):swal({title:"Once you save this option you will not have the ability to change or modify it.",text:"Are you sure you want to make this change?",type:"warning",confirmButtonText:"Yes",cancelButtonText:"No",showCancelButton:!0},(function(isConfirm){isConfirm?updatePriorityTable($(event.target).closest("table"),$(event.target).closest("tr")):$(event.target).attr("checked",!1)}))})),$("body").on("click",".filterValueCheckbox:not(:checked)",(function(event){updatePriorityTable($(event.target).closest("table"),$(event.target).closest("tr"))})),window.historical=!1,1==window.top.isSupport){pikadaySettingsObject={firstDay:1,minDate:new Date(1990,0,1),maxDate:new Date(2040,12,31),yearRange:[1990,2040],format:"MM/DD/YYYY",defaultDate:new Date,setDefaultDate:!0};var pikDay=$("#getAsOfDateIn").pikaday(pikadaySettingsObject);$("#asOfTime").val(`${(new Date).getHours()}:${(new Date).getMinutes()}`),$("body").on("change","#getAsOfDateIn",(function(e){window.historical=!0,$("#dropdownsTable").DataTable().rows().remove().draw(),populateRequestTypesTable(`${$("#getAsOfDateIn").val()} ${$("#asOfTime").val()}`),hideRequestTypeEditor()})),$("body").on("change","#asOfTime",(function(e){window.historical=!0,$("#dropdownsTable").DataTable().rows().remove().draw(),populateRequestTypesTable(`${$("#getAsOfDateIn").val()} ${$("#asOfTime").val()}`),hideRequestTypeEditor()}))}},stringNotifications=function(notification){var str="";return $.each(notification,(function(int,item){str+=""==str?JSON.stringify(item):"||| "+JSON.stringify(item)})),""==str&&(str="null"),str},initFilterTable=function(fieldOptions,requestSettings,requestTypeFieldId){var $table;if(null==fieldOptions||0!=fieldOptions.length)if($("#filterValueManagmentTable").length>0){var tableData=[];$.each(fieldOptions,(function(index,option){var optionSettings={},emptyObj={id:null,requestTypeFieldId:requestTypeFieldId,dropDownOptionId:option.dropdownOptionId,sortOrder:index+1,queueable:!1};0==requestSettings.length?optionSettings=emptyObj:null==(optionSettings=requestSettings.find(x=>x.dropDownOptionId==option.dropdownOptionId))&&(optionSettings=emptyObj);var rowData={id:optionSettings.id,sortOrder:optionSettings.sortOrder,optionName:option.displayName,queueable:optionSettings.queueable,existing:null!=optionSettings.id&&1==optionSettings.queueable,requestTypeFieldId:optionSettings.requestTypeFieldId,dropDownOptionId:option.dropdownOptionId};tableData.push(rowData)}));var columnDefs=[{className:"dragHandle",name:"",orderable:!1,data:null,defaultContent:"",title:"",render:function(data,type,row){var holderDiv=$("<div>"),requestItemDragHandle=$('<div title="Drag Handle" class="requestItemDragHandle">').append($('<i class="material-icons">').text("reorder")),requestItemDragToReorder=$('<button class="requestItemDragToReorder btn">');if(requestItemDragToReorder.append(requestItemDragHandle),holderDiv.append(requestItemDragToReorder),!row.queueable)return holderDiv.html()}},{data:"sortOrder",name:"sortOrder",title:"Order"},{data:"optionName",name:"optionName",title:"Option Name"},{data:"queueable",name:"filterValue",title:"Filter Value",render:function(data,type,row){var checked="",disable="";return data&&(checked="checked"),0==window.top.isSupport&&row.existing&&(disable="disabled title='Contact Support to alter this option.'"),`<input type="checkbox" class="filterValueCheckbox" ${disable} existing=${row.existing} ${checked}></input>`}}],reorderSettings={snapX:!0,selector:"td:first-child .requestItemDragToReorder",dataSrc:"sortOrder"},table;$.fn.DataTable.isDataTable("#filterValueManagmentTable")&&($("#filterValueManagmentTable").DataTable().destroy(),$("#filterValueManagmentTable").empty()),tableData=utilities().sortArray(tableData,"sortOrder"),$("#filterValueManagmentTable").DataTable({columns:columnDefs,columnDefs:[{searchable:!1,targets:[0]}],data:tableData,ordering:!1,info:!1,order:[[2,"asc"]],searching:!1,paging:!1,autoWidth:!1,rowReorder:reorderSettings}).on("row-reordered",(function(event,diff,edit){console.log(event,diff,edit);var datatable=$(event.target).DataTable(),data=utilities().sortArray(datatable.data().toArray(),"sortOrder");datatable.clear(),datatable.rows.add(data),datatable.draw(),updatePriorityTable($(event.target))}))}else console.warn("Did not find filter table body.")},updatePriorityTable=function(table,row=null){var datatable=$(table).DataTable();row&&(datatable.row(row).data().queueable=!datatable.row(row).data().queueable);var data=datatable.data().toArray();data=data.filter(x=>x.queueable).concat(data.filter(x=>!x.queueable)),$.each(data,(function(index,obj){if(obj.queueable)obj.sortOrder=1;else{var filterLen=data.filter(x=>x.queueable).length,offset=0==filterLen?1:2;obj.sortOrder=index+offset-filterLen}})),console.log(data),datatable.clear(),datatable.rows.add(data),datatable.draw()};let populateApplications=async function(appList){appList.forEach((function(app,index){let appOption=$("<option>").addClass("requestTypeAllowedOption").val(app.id).text(app.name);$("#requestTypeAllowedAppsSelect").append(appOption)}))},updateCustAttrDefs=async function(appId){let vendorEndpointData,vendorCustAttrDefList=(await ajaxModule().getVendorEndpointData(appId)).requestTypeCustomAttributeDefinitions;vendorCustAttrDefList.length>0&&(custAttrDefList=[],vendorCustAttrDefList.forEach((function(attrDef){let requestTypeCustAttrDef=requestTypeCustomAttributeDefinitions.find(rtAttrDef=>rtAttrDef.vendorAttributeId==attrDef.vendorAttributeId&&rtAttrDef.isFieldLevel==attrDef.isFieldLevel),attrToUse=attrDef;requestTypeCustAttrDef&&(attrToUse=requestTypeCustAttrDef),custAttrDefList.push(attrToUse)})),$("#requestTypeAttributeTable").show(),$("#requestTypeFieldAttributesTable").show())},addCustomAttributeToEditor=function(val,attrDefsList){addAttrRowToTable(val,attrDefsList,"requestTypeCustomAttributesTable",!1)},addFieldCustomAttributeToEditor=function(val,attrDefsList){addAttrRowToTable(val,attrDefsList,"requestTypeFieldCustomAttributesTable",!0)},addAttrRowToTable=function(val,attrDefsList,tableId,isFieldLevel){let tableRow=$("<tr></tr>"),attrDropdownTd=$("<td></td>").addClass("attrDropdown"),attrDescTd=$("<td></td>").addClass("attrDesc").text("Please select an attribute to the left."),attrDataTypeTd=$("<td></td>").addClass("attrDataType"),valEntryTd=$("<td></td>").addClass("attrVal"),deleteBtnTd=$("<td></td>").addClass("attrDel"),attrDropdown=makeAttrDropdown(isFieldLevel);if(attrDropdown.on("change",(function(){attrDropdownChangeEvt($(this),$(this).val(),tableRow,attrDescTd,attrDataTypeTd,valEntryTd,isFieldLevel)})),val){let valDefId=val.requestTypeCustAttribDefId,valDef=mapCustAttrIdToVendorAttr(attrDefsList,valDefId,isFieldLevel);valDef&&(tableRow.attr("requestTypeCustAttribDefId",valDefId),attrDropdown.val(valDef.vendorAttributeId),attrDropdownChangeEvt(attrDropdown,valDef.vendorAttributeId,tableRow,attrDescTd,attrDataTypeTd,valEntryTd,isFieldLevel,val))}else deleteBtnTd.append($("<button>").addClass("editorSectionTableRowDeleteButton").text("Delete"));attrDropdownTd.append(attrDropdown),tableRow.append(attrDropdownTd,attrDescTd,attrDataTypeTd,valEntryTd,deleteBtnTd),$(`#${tableId}`).append(tableRow),updateAttrDropdowns(tableId)},makeAttrDropdown=function(isFieldLevel){let selectObj=$("<select>").append($("<option>").text("Select an attribute").attr("disabled",!0).attr("selected",!0).attr("emptyAttr",!0)),attrList;return custAttrDefList.filter(attr=>attr.isFieldLevel==isFieldLevel).forEach(attr=>{selectObj.append(makeAttrOption(attr))}),selectObj},makeAttrOption=function(attr){return $("<option>").text(attr.displayLabel).val(attr.vendorAttributeId).addClass("vendorAttrDropDownOption").attr("title",attr.displayDescription)},attrDropdownChangeEvt=function(attrDropdown,vendorId,tableRow,descriptionTd,dataTypeTd,valTd,isFieldLevel,val){let attr=custAttrDefList.find(a=>a.isFieldLevel==isFieldLevel&&a.vendorAttributeId==vendorId);if(attr){tableRow.attr("datatype",attr.displayDataType),tableRow.attr("vendorid",vendorId),descriptionTd.text(attr.displayDescription),dataTypeTd.text(CUST_ATTR_DATA_TYPE_LABELS[attr.displayDataType]);let valInput=makeAttrValInput(attr,val);valTd.html(valInput),val&&(tableRow.attr("id",val.id),attrDropdown.attr("disabled",!0),valInput.attr("disabled",!0)),updateAttrDropdowns($(tableRow).parent().parent().attr("id"))}},makeAttrValInput=function(attr,val){let input=$("<input>"),inputVal=attr.displayDefaultValue;if(attr.displayDataType==CUST_ATTR_DATA_TYPES.STRING)input.attr("type","text"),val&&(inputVal=val.textValue),input.val(inputVal);else if(attr.displayDataType==CUST_ATTR_DATA_TYPES.NUMERIC)input.attr("type","number"),val&&(inputVal=val.decimalValue),input.val(inputVal);else if(attr.displayDataType==CUST_ATTR_DATA_TYPES.DATE){input.attr("type","text"),val&&(inputVal=val.dateValue);let pikadaySettingsObject={firstDay:1,minDate:new Date(1990,0,1),maxDate:new Date(2040,12,31),yearRange:[1990,2040],format:"MM/DD/YYYY",defaultDate:new Date,setDefaultDate:!0};input.pikaday(pikadaySettingsObject),input.val(inputVal)}else if(attr.displayDataType==CUST_ATTR_DATA_TYPES.LONG_TEXT)input=$("<textarea>"),val&&(inputVal=val.longTextValue),input.val(inputVal);else if(attr.displayDataType==CUST_ATTR_DATA_TYPES.BOOLEAN)input.attr("type","checkbox"),val&&(inputVal=val.boolValue),input.attr("checked",utilities().stringToBool(inputVal));else if(attr.displayDataType==CUST_ATTR_DATA_TYPES.DROP_DOWN){if(input=makeAttrValDropdown(attr.requestTypeCustomAttributeDropDownOptionDefinitionList),val){let requestTypeCustAttribDropdownOptDefId=val.requestTypeCustAttribDropdownOptDefId,selectedOption=attr.requestTypeCustomAttributeDropDownOptionDefinitionList.find(optionDef=>optionDef.id==requestTypeCustAttribDropdownOptDefId);selectedOption&&(inputVal=selectedOption.optionKey)}input.val(inputVal)}return input},makeAttrValDropdown=function(attrDropDownOptionDefinitionList){let selectObj=$("<select>").append($("<option>").text("Select a value").attr("disabled",!0).attr("selected",!0));return attrDropDownOptionDefinitionList.forEach((function(def){selectObj.append($("<option>").val(def.optionKey).text(def.optionValue))})),selectObj},getCustAttrValList=function(tableId,parentIdLabel,parentId){let valList=[],tableRowList;return $(`#${tableId} > tbody`).children().toArray().forEach((function(row){let val=getCustAttrVal(row,parentIdLabel,parentId);val&&valList.push(val)})),valList},getCustAttrVal=function(row,parentIdLabel,parentId){let vendorId=$(row).attr("vendorId");if(!vendorId)return null;let valObj={vendorAttributeId:vendorId},valId=$(row).attr("id"),dataType=$(row).attr("datatype"),valDefId=$(row).attr("requestTypeCustAttribDefId"),val,valueLabel;return dataType==CUST_ATTR_DATA_TYPES.STRING?(val=$(row).find(".attrVal > input").val(),valueLabel="textValue"):dataType==CUST_ATTR_DATA_TYPES.NUMERIC?(val=$(row).find(".attrVal > input").val(),valueLabel="decimalValue"):dataType==CUST_ATTR_DATA_TYPES.DATE?(val=$(row).find(".attrVal > input").val(),valueLabel="dateValue"):dataType==CUST_ATTR_DATA_TYPES.LONG_TEXT?(val=$(row).find(".attrVal > textarea").val(),valueLabel="longTextValue"):dataType==CUST_ATTR_DATA_TYPES.BOOLEAN?(val=$(row).find(".attrVal > input").attr("checked"),valueLabel="boolValue"):dataType==CUST_ATTR_DATA_TYPES.DROP_DOWN&&(val=$(row).find(".attrVal > select").val(),valueLabel="dropDownValue"),valObj[valueLabel]=val,valId&&(valObj.id=valId),valDefId&&(valObj.requestTypeCustAttribDefId=valDefId),parentIdLabel&&parentId&&(valObj[parentIdLabel]=parentId),valObj},getSelectedAttributeVendorIdList=function(tableId){let dropdownList;return $(`#${tableId} > tbody > tr > .attrDropdown > select`).toArray().map(dropdown=>$(dropdown).val()).filter(dropdown=>dropdown)},updateAttrDropdowns=function(tableId){let selectedAttrList;$(`#${tableId} .attrDropdown > select > option[emptyAttr!=true]`).attr("disabled",!1),getSelectedAttributeVendorIdList(tableId).forEach(attr=>{$(`#${tableId} .attrDropdown > select > option[value=${attr}]`).attr("disabled",!0)})},mapCustAttrIdToVendorAttr=function(attrDefsList,requestTypeCustAttribDefId,isFieldLevel){return attrDefsList.find(attr=>attr.id==requestTypeCustAttribDefId&&attr.isFieldLevel==isFieldLevel)};return{populateUsersAndUserGroupsAllowedTables:populateUsersAndUserGroupsAllowedTables,documentReadyFunction:documentReadyFunction,populateRequestTypesTable:populateRequestTypesTable}},requestTypeModule=editRequestTypes();$(document).ready((function(){requestTypeModule.documentReadyFunction()}));
//# sourceMappingURL=editRequestTypes.min.js.map