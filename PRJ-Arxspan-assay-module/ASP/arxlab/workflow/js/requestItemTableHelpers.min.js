var requestItemTableHelpers=function(){var setDefaultItemFieldValues,checkDropdownDependency=function(val,targetJSON,thisDisplayName,fieldType,select){if(Object.keys(targetJSON).includes(val)){var divsToPop=targetJSON[val];$.each(divsToPop,(function(divIndex,target){var targetFieldId=Object.keys(target)[0],targetDiv;if("requestType"==fieldType)targetDiv=$(".editorField[requesttypefieldid="+targetFieldId+"]").find("select");else{var row=$($($(select).parent()).parent()).parent();targetDiv=$(row).find("div[requestitemtypefieldid='"+targetFieldId+"'] > select")}var targetOptionsHtml=target[targetFieldId],targetVal=$(targetDiv.find("option:selected")).val(),allowedOptions=[];targetDiv.empty(),$.each(targetOptionsHtml,(function(targetHtmlIndex,optionHtml){targetDiv.append(optionHtml),allowedOptions.push(optionHtml.val())})),utilities().sortDropdownlist(targetDiv),1==targetDiv.find("option:not([emptyDefaultOption])").length?targetDiv.find("option:not([emptyDefaultOption])").prop("selected",!0):targetDiv.find("option[value='"+targetVal+"']").prop("selected",!0),allowedOptions.includes(targetVal)||targetDiv.change()}))}else{var divsToEmpty=targetJSON.empty;$.each(divsToEmpty,(function(divIndex,targetFieldId){var targetDiv;if("requestType"==fieldType)targetDiv=$(".editorField[requesttypefieldid="+targetFieldId+"]").find("select");else{var row=$($($(select).parent()).parent()).parent();targetDiv=$(row).find("div[requestitemtypefieldid='"+targetFieldId+"'] > select")}var targetVal=$(targetDiv.find("option:selected")).val();targetDiv.empty();var dependencyOption=$("<option></option>");dependencyOption.val(""),dependencyOption.text("-- Dropdown is dependent on field: "+thisDisplayName+" --"),targetDiv.append(dependencyOption),utilities().sortDropdownlist(targetDiv),1==targetDiv.find("option:not([emptyDefaultOption])").length?targetDiv.find("option:not([emptyDefaultOption])").prop("selected",!0):targetDiv.find("option[value='"+targetVal+"']").prop("selected",!0),""!=targetVal&&targetDiv.change()}))}},applyCellDependency=function(select,requestItemTypeId,versionedRequestItems,versionedFields){if(Array.isArray(versionedRequestItems)){var requestItemType=versionedRequestItems.find(x=>x.id==requestItemTypeId),parent=$(select).parent(),requestItemTypeFieldId=$(parent).attr("requestitemtypefieldid"),requestItemTypeField=requestItemType.fieldsDict[requestItemTypeFieldId][0],fieldDependencies=requestItemTypeField.requestItemTypeFieldDropDownDependencies,thisSavedFieldId=requestItemTypeField.savedFieldId,thisSavedField,thisDisplayName=versionedFields.find(x=>x.id==thisSavedFieldId).displayName,emptyDefaultOption=$("<option emptydefaultoption></option>");emptyDefaultOption.val(""),emptyDefaultOption.text("-- Make a Selection --");var targetJSON={empty:[]};$.each(fieldDependencies,(function(depIndex,dependency){var dropdownOptionId=dependency.dropDownOptionId,targetFieldId=dependency.targetRequestItemTypeFieldId,targetValues=dependency.requestItemTypeFieldDropDownDependencyValues.map(x=>x.targetDropDownOptionId),targetField,targetSavedFieldId=requestItemType.fieldsDict[targetFieldId][0].savedFieldId,targetSavedField,targetOptions,targetOptionsHtml=versionedFields.find(x=>x.id==targetSavedFieldId).options.filter(x=>targetValues.includes(x.dropdownOptionId)).map((function(option){var optionHtml=$("<option></option>");return optionHtml.val(option.dropdownOptionId),optionHtml.text(option.displayName),optionHtml}));targetOptionsHtml.unshift(emptyDefaultOption.clone()),Object.keys(targetJSON).includes(dropdownOptionId.toString())||(console.log("Logging some nonsense to make sure multiple dependencies don't break."),targetJSON[dropdownOptionId]=[]);var targetObj={};targetObj[targetFieldId]=targetOptionsHtml,targetJSON[dropdownOptionId].push(targetObj),targetJSON.empty.includes(targetFieldId)||targetJSON.empty.push(targetFieldId)})),$(select).change((function(){checkDropdownDependency($(this).val(),targetJSON,thisDisplayName,"requestItemType",select)})),checkDropdownDependency($(select).val(),targetJSON,thisDisplayName,"requestItemType",select)}},applyItemDependencies;return{setDefaultItemFieldValues:function(tableId,rowNum,versionedRequestItems,enforceDirty=!1){return new Promise((function(resolve,reject){if(void 0!==versionedRequestItems){var theTable=$("#"+tableId),requestItemTypeId=theTable.attr("requestitemtypeid"),itemType=void 0;if($.each(versionedRequestItems,(function(ai,thisItemType){if(thisItemType.hasOwnProperty("id")&&thisItemType.id==requestItemTypeId)return itemType=thisItemType,!1})),null==itemType||!itemType.hasOwnProperty("id")||!itemType.hasOwnProperty("fields"))return!0;var itemTypeId=itemType.id;if(console.log("processing default values for request item type: ",itemTypeId),$.fn.DataTable.isDataTable(theTable)){var redrawRow=!1;$.each(theTable.DataTable().cells(),(function(cellIndex,theCells){$.each(theCells,(function(iCell,cell){if(cell.hasOwnProperty("row")&&cell.row!=rowNum)return!0;var theCell=cell,cellNode=theTable.DataTable().cell({row:theCell.row,column:theCell.column}).node(),requestItemNode=$(cellNode).find("[requestitemtypefieldid]"),requestItemTypeFieldId=$(requestItemNode).attr("requestitemtypefieldid");$.each(itemType.fieldsDict.sortOrder,(function(fieldNum,theFieldId){var theField;if(itemType.fieldsDict[theFieldId].length>1){var groupId,fieldSettings=itemType.fieldsDict[theFieldId],userId;if(groupId=$("#assignedUserGroupDropdown").val()?$("#assignedUserGroupDropdown").val():globalUserInfo.userGroups[0],$(".userDropdown").length>0)var userId=$("#userDropdown").val();else var userId=window.globalUserInfo.userId;var companyOption=fieldSettings.find(x=>null!=x.defaultValue),groupSettings=fieldSettings.find(x=>x.groupId==groupId),myGroupSettings=fieldSettings.filter(x=>globalUserInfo.userGroups.includes(x.groupId)),userSetting=fieldSettings.find(x=>userId==x.userId);if(userSetting)theField=userSetting;else if(groupSettings)theField=groupSettings;else if(myGroupSettings.length>0)theField=myGroupSettings[0];else{if(!companyOption)return!0;theField=companyOption}}else theField=itemType.fieldsDict[theFieldId][0];if(!theField.hasOwnProperty("requestTypeFieldId")||theField.requestTypeFieldId!=requestItemTypeFieldId)return!0;if(theField.hasOwnProperty("defaultValue")&&null!=theField.defaultValue&&""!=theField.defaultValue){var thisCell=theTable.DataTable().cell({row:theCell.row,column:theCell.column});$.each($(cellNode).find("[requestitemtypefieldid="+theField.requestTypeFieldId+"]"),(function(nodeIndex,node){var element=$(node).find('select option[value="'+theField.defaultValue+'"]');element.is("option")&&(null==thisCell.data()||1==thisCell.data().data.length&&null==thisCell.data().data[0])?(redrawRow=!0,thisCell.data({data:[parseInt(theField.defaultValue)],dirty:enforceDirty})):(element=$(node).find("input")).is("input")&&(null==thisCell.data()||1==thisCell.data().data.length&&null==thisCell.data().data[0])&&(redrawRow=!0,thisCell.data({data:[theField.defaultValue],dirty:enforceDirty}))}))}return!1}))}))})),redrawRow&&theTable.DataTable().row(rowNum).draw("page")}}resolve(!0)}))},applyItemDependencies:function(tableId,rowNum,versionedRequestItems,versionedFields){var tableIdStr="#"+tableId,theTable,requestItemTypeId=$(tableIdStr).attr("requestitemtypeid"),tableRows,row=$("table"+tableIdStr+" > tbody > tr")[rowNum],dropdowns=$(row).find("select");$.each(dropdowns,(function(selIndex,select){applyCellDependency(select,requestItemTypeId,versionedRequestItems,versionedFields)}))},checkDropdownDependency:checkDropdownDependency}};
//# sourceMappingURL=requestItemTableHelpers.min.js.map