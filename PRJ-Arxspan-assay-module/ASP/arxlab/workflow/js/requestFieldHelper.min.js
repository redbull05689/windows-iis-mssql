var requestFieldHelper=function(){const EXP_SEARCH_URL="/arxlab/ajax_loaders/fetchExperimentSearchTypeAhead.asp",WRITABLE_EXP_SEARCH_URL="/arxlab/ajax_loaders/fetchWritableExperimentSearchTypeAhead.asp";var NavToNotebook,NavToProject,NavToExperement,clearSelect2Field,initAllSealectFields=function(versionedRequestItems,versionedFields){if(window.preventNotification=1,$("input#searchForNotebook").length>0){var notebookfields=$("input#searchForNotebook");$.each(notebookfields,(function(i,obj){initNotebookSearch(obj,versionedRequestItems,versionedFields)}))}if($("input#searchForProject").length>0){var Projectfields=$("input#searchForProject");$.each(Projectfields,(function(i,obj){initProjectSearch(obj,versionedRequestItems,versionedFields)}))}if($("input#searchForExperement").length>0){var Experementfields=$("input#searchForExperement");$.each(Experementfields,(function(i,obj){initExperementSearch(obj,EXP_SEARCH_URL,versionedRequestItems,versionedFields)}))}initExperementSearch($("#workflowFileExperimentSearch"),WRITABLE_EXP_SEARCH_URL,versionedRequestItems,versionedFields),window.preventNotification=0},initNotebookSearch=function(Field,versionedRequestItems,versionedFields){var disabled=!1,fn;if("1"==$(Field).attr("autoGen")&&(disabled=!0),$("#overlay_select2Compatible").addClass("makeVisible"),"true"!=$(Field).attr("initialized")){if(elnSearchBox=$(Field).select2({formatSearching:null,selectOnBlur:!1,minimumInputLength:3,disabled:disabled,formatResult:function(object,container,query){var contentHTML="";return"specialResult_searchFor"==object.id||(contentHTML+='<div class="resultContent">',resultNameHTML=object.name,object.userExperimentName&&""!==object.userExperimentName&&null!==object.userExperimentName&&(resultNameHTML+=" - "+object.userExperimentName),contentHTML+='<div class="resultNameRow"><div class="resultExperimentName">'+resultNameHTML+"</div></div>",contentHTML+='<div class="resultDetailsRow">'+object.desc+"</div>",contentHTML+="</div>"),contentHTML},ajax:{url:"/arxlab/ajax_loaders/fetchNotebookSearchTypeahead.asp",dataType:"html",delay:250,method:"POST",type:"POST",contentType:"application/x-www-form-urlencoded",data:function(params){return{userInputValue:params}},results:function(data,params){var i=0;for(resultsArray=JSON.parse(data);i<resultsArray.length;)resultsArray[i].id=resultsArray[i].id,resultsArray[i].text=resultsArray[i].name,i++;return{results:resultsArray}},cache:!1},dropdownCssClass:"elnSearchTypeaheadDropdown searchForNotebook",formatInputTooShort:function(){return"Please enter at least 3 characters"},openOnEnter:!1,placeholder:""}).data("select2"),elnSearchBox.onSelect=(fn=elnSearchBox.onSelect,function(data,options){window.linkedExperimentInfo=data,instantiateNotebookLink(Field,data.id,data.text),$(Field).select2("close"),$("td").has(Field).length>0&&dataTableModule().updateRequestItemsTableDataAndRedraw($(Field),versionedRequestItems,versionedFields)}),$(Field).select2("data",{id:-1,text:""}),$(Field).children().length>0){var optionId=$($(Field).children()[0]).attr("id"),optionName=$($(Field).children()[0]).val();null!=optionId&&instantiateNotebookLink(Field,optionId,optionName)}else if($(Field).siblings("option[fieldid ="+$(Field).attr("fieldid")+"]").length>0){var refrance=$(Field).siblings("option[fieldid ="+$(Field).attr("fieldid")+"]"),optionId=$(refrance).attr("id"),optionName=$(refrance).val();$(Field).siblings("option[fieldid ="+$(Field).attr("fieldid")+"]").remove(),instantiateNotebookLink(Field,optionId,optionName)}$(Field).attr("initialized",!0)}console.log("Notebook")},initProjectSearch=function(Field,versionedRequestItems,versionedFields){var disabled=!1,fn;if("1"==$(Field).attr("autoGen")&&(disabled=!0),$("#overlay_select2Compatible").addClass("makeVisible"),"true"!=$(Field).attr("initialized")){if(elnSearchBox=$(Field).select2({formatSearching:null,selectOnBlur:!1,minimumInputLength:3,disabled:disabled,formatResult:function(object,container,query){var contentHTML="";return"specialResult_searchFor"==object.id||(contentHTML+='<div class="resultContent">',resultNameHTML=object.name,object.userExperimentName&&""!==object.userExperimentName&&null!==object.userExperimentName&&(resultNameHTML+=" - "+object.userExperimentName),contentHTML+='<div class="resultNameRow"><div class="resultExperimentName">'+resultNameHTML+"</div></div>",contentHTML+='<div class="resultDetailsRow">'+object.desc+"</div>",contentHTML+="</div>"),contentHTML},ajax:{url:"/arxlab/ajax_loaders/fetchProjectSearchTypeahead.asp",dataType:"html",delay:250,method:"POST",type:"POST",contentType:"application/x-www-form-urlencoded",data:function(params){return{userInputValue:params}},results:function(data,params){var i=0;for(resultsArray=JSON.parse(data);i<resultsArray.length;)resultsArray[i].id=resultsArray[i].id,resultsArray[i].text=resultsArray[i].name,i++;return{results:resultsArray}},cache:!1},dropdownCssClass:"elnSearchTypeaheadDropdown searchForNotebook",formatInputTooShort:function(){return"Please enter at least 3 characters"},openOnEnter:!1,placeholder:""}).data("select2"),elnSearchBox.onSelect=(fn=elnSearchBox.onSelect,function(data,options){window.linkedExperimentInfo=data,instantiateProjectLink(Field,data.id,data.text),$(Field).select2("close"),$("td").has(Field).length>0&&dataTableModule().updateRequestItemsTableDataAndRedraw($(Field),versionedRequestItems,versionedFields)}),$(Field).children().length>0){var optionId=$($(Field).children()[0]).attr("id"),optionName=$($(Field).children()[0]).val();"null"!=optionId&&instantiateProjectLink(Field,optionId,optionName)}else if($(Field).siblings("option[fieldid ="+$(Field).attr("fieldid")+"]").length>0){var refrance=$(Field).siblings("option[fieldid ="+$(Field).attr("fieldid")+"]"),optionId=$(refrance).attr("id"),optionName=$(refrance).val();$(Field).siblings("option[fieldid ="+$(Field).attr("fieldid")+"]").remove(),instantiateProjectLink(Field,optionId,optionName)}$(Field).attr("initialized",!0)}console.log("Project")},initExperementSearch=function(Field,searchUrl,versionedRequestItems,versionedFields){var disabled=!1,fn;if("1"==$(Field).attr("autoGen")&&(disabled=!0),$("#overlay_select2Compatible").addClass("makeVisible"),"true"!=$(Field).attr("initialized")){if(elnSearchBox=$(Field).select2({formatSearching:null,selectOnBlur:!1,minimumInputLength:3,disabled:disabled,formatResult:function(object,container,query){var contentHTML="";return"specialResult_searchFor"==object.id||(contentHTML+='<div class="resultContent">',resultNameHTML=object.text,object.userExperimentName&&""!==object.userExperimentName&&null!==object.userExperimentName&&(resultNameHTML+=" - "+object.userExperimentName),contentHTML+='<div class="resultNameRow"><div class="resultExperimentName">'+resultNameHTML+"</div></div>",contentHTML+='<div class="resultDetailsRow">'+object.desc+"</div>",contentHTML+="</div>"),contentHTML},ajax:{url:searchUrl,dataType:"html",delay:250,method:"POST",type:"POST",contentType:"application/x-www-form-urlencoded",data:function(params){return{userInputValue:params}},results:function(data,params){var i=0;for(resultsArray=JSON.parse(data);i<resultsArray.length;)resultsArray[i].id=parseInt(resultsArray[i].legacyId),resultsArray[i].text=resultsArray[i].name,resultsArray[i].desc=resultsArray[i].userExperimentName,1==resultsArray[i].experimentType?resultsArray[i].index="chem":2==resultsArray[i].experimentType?resultsArray[i].index="bio":3==resultsArray[i].experimentType?resultsArray[i].index="free":4==resultsArray[i].experimentType?resultsArray[i].index="anal":5==resultsArray[i].experimentType&&(resultsArray[i].index="cust"),i++;return{results:resultsArray}},cache:!1},dropdownCssClass:"elnSearchTypeaheadDropdown searchForNotebook",formatInputTooShort:function(){return"Please enter at least 3 characters"},openOnEnter:!1,placeholder:""}).data("select2"),elnSearchBox.onSelect=(fn=elnSearchBox.onSelect,function(data,options){window.linkedExperimentInfo=data,instantiateExpLink(Field,data.id,data.text,data.index,data.userId,data.experimentType),instantiateClearLink($(Field).attr("fieldId")),$(Field).select2("close"),$("td").has(Field).length>0&&dataTableModule().updateRequestItemsTableDataAndRedraw($(Field),versionedRequestItems,versionedFields)}),$(Field).children().length>0){var optionData=JSON.parse($($(Field).children()[0]).val());null!=optionData&&(optionData.id=$($(Field).children()[0]).attr("id"),"null"!=optionData.id&&(instantiateExpLink(Field,optionData.id,optionData.text,optionData.index,optionData.owner,optionData.experimentType),instantiateClearLink($(Field).attr("fieldId"))))}else if($(Field).siblings("option[fieldid ="+$(Field).attr("fieldid")+"]").length>0){var refrance=$(Field).siblings("option[fieldid ="+$(Field).attr("fieldid")+"]"),optionId=$(refrance).attr("id"),optionName=$(refrance).val(),optionindex=$(refrance).attr("index"),optionOwner=$(refrance).attr("owner"),optionType=$(refrance).attr("experimentType");$(Field).siblings("option[fieldid ="+$(Field).attr("fieldid")+"]").remove(),instantiateExpLink(Field,optionId,optionName,optionindex,optionOwner,optionType),instantiateClearLink($(Field).attr("fieldId"))}$(Field).attr("initialized",!0)}console.log("experiment")},instantiateLink=function(field,linkData,navFncStr){$(field).select2("data",linkData).trigger("change");var navLinkSelector=`.navigateLink[fieldId="${$(field).attr("fieldId")}"]`;$(navLinkSelector).show(),$(navLinkSelector).attr("onClick",navFncStr)},instantiateNotebookLink=function(field,id,text){var linkData={id:id,text:text},navFncStr=`requestFieldHelper().NavToNotebook("${String(id)}");`;instantiateLink(field,linkData,navFncStr)},instantiateProjectLink=function(field,id,text){var linkData={id:id,text:text},navFncStr=`requestFieldHelper().NavToProject("${String(id)}");`;instantiateLink(field,linkData,navFncStr)},instantiateExpLink=function(field,id,text,index,userId,experimentType){var linkData={id:id,text:text,index:index,owner:userId,type:experimentType},navFncStr=`requestFieldHelper().NavToExperement('${String(id)}', '${String(index)}')`;instantiateLink(field,linkData,navFncStr)},instantiateClearLink=function(fieldId){var clearLinkSelector=`.clearLink[fieldId="${fieldId}"]`;$(clearLinkSelector).show(),$(clearLinkSelector).attr("onClick",`requestFieldHelper().clearSelect2Field("${fieldId}")`)},initRegSearch=function(){registrationSearchBox=$("input#searchRegistration").select2({formatSearching:null,createSearchChoice:function(term,data){},text:function(item){return item.regId},selectOnBlur:!1,ajax:{url:"/arxlab/ajax_loaders/fetchRegistrationSearchTypeahead.asp",dataType:"html",quietMillis:600,method:"POST",type:"POST",contentType:"application/x-www-form-urlencoded",data:function(params){return{userInputValue:params,r:Math.random()}},results:function(data,params){var i=0;for(resultsArray=JSON.parse(data).results;i<resultsArray.length;)resultsArray[i].id=resultsArray[i].regId,i++;return{results:resultsArray}},cache:!1,timeout:1500},escapeMarkup:function(markup){return markup},minimumInputLength:1,formatResult:function(object,container,query){return headingHTML='<div class="resultHeading">',contentHTML='<div class="resultContent">',$.each(object,(function(columnName,value){"id"!==columnName&&"cd_id"!==columnName&&(headingHTML+='<div class="colHeader">'+columnName+"</div>",contentHTML+='<div class="colContent">'+value+"</div>")})),headingHTML+="</div>",contentHTML+="</div>",headingHTML+contentHTML},formatSelection:function(item){return window.linkedRegIdInfo=item,item.regId},formatSearching:null,initSelection:function(element,callback){var data;callback({id:element.val(),regId:element.val()})},openOnEnter:!1,dropdownCssClass:"elnRegIdLookupDropdown"})},applyDependencies=function(thisRequestType,versionedFields){var dropdowns=$(".editorFieldInputContainer > select");$.each(dropdowns,(function(selIndex,select){applyDependency(select,thisRequestType,versionedFields)}))},applyDependency=function(select,thisRequestType,versionedFields){var parent=$(select).closest(".editorField"),requestTypeFieldId=$(parent).attr("requesttypefieldid");if(Object.keys(thisRequestType.fieldsDict).includes(requestTypeFieldId)){var requestTypeField=thisRequestType.fieldsDict[requestTypeFieldId][0],fieldDependencies=requestTypeField.requestTypeFieldDropDownDependencies,thisSavedFieldId=requestTypeField.savedFieldId,thisSavedField,thisDisplayName=versionedFields.find(x=>x.id==thisSavedFieldId).displayName,emptyDefaultOption=$("<option emptydefaultoption></option>");emptyDefaultOption.val(""),emptyDefaultOption.text("-- Make a Selection --");var targetJSON={empty:[]};$.each(fieldDependencies,(function(depIndex,dependency){var dropdownOptionId=dependency.dropDownOptionId,targetFieldId=dependency.targetRequestTypeFieldId,targetValues=dependency.requestTypeFieldDropDownDependencyValues.map(x=>x.targetDropDownOptionId),targetField,targetSavedFieldId=thisRequestType.fieldsDict[targetFieldId][0].savedFieldId,targetSavedField,targetOptions,targetOptionsHtml=versionedFields.find(x=>x.id==targetSavedFieldId).options.filter(x=>targetValues.includes(x.dropdownOptionId)).map((function(option){var optionHtml=$("<option></option>");return optionHtml.val(option.dropdownOptionId),optionHtml.text(option.displayName),optionHtml}));targetOptionsHtml.unshift(emptyDefaultOption.clone()),Object.keys(targetJSON).includes(dropdownOptionId.toString())||(targetJSON[dropdownOptionId]=[]);var targetObj={};targetObj[targetFieldId]=targetOptionsHtml,targetJSON[dropdownOptionId].push(targetObj),targetJSON.empty.includes(targetFieldId)||targetJSON.empty.push(targetFieldId)})),$(select).change((function(){requestItemTableHelpers().checkDropdownDependency($(this).val(),targetJSON,thisDisplayName,"requestType",select)})),requestItemTableHelpers().checkDropdownDependency($(select).val(),targetJSON,thisDisplayName,"requestType",select)}};return{initAllSealectFields:initAllSealectFields,NavToNotebook:function(ID){window.open("../show-notebook.asp?id="+ID," _blank")},NavToProject:function(ID){window.open("../show-project.asp?id="+ID," _blank")},NavToExperement:function(ID,index){"chem"==index?window.open("../experiment.asp?id="+ID," _blank"):window.open("../"+String(index)+"-experiment.asp?id="+ID," _blank")},clearSelect2Field:function(fieldId){var navLinkSelector,clearLinkSelector=`.clearLink[fieldId="${fieldId}"]`;$(`.navigateLink[fieldId="${fieldId}"]`).hide(),$(clearLinkSelector).hide(),$(`input[fieldId="${fieldId}"]`).select2("data",{id:-1,text:""}),$(`input[fieldId="${fieldId}"]`).change(),$(`input[fieldId="${fieldId}"]`).keydown()},applyDependencies:applyDependencies}};
//# sourceMappingURL=requestFieldHelper.min.js.map